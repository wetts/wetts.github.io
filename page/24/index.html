<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wetts.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Stay Hungry, Stay Foolish. [build by hexo&#x2F;next&#x2F;gitalk&#x2F;hexo-generator-search&#x2F;LaTeX]">
<meta property="og:type" content="website">
<meta property="og:title" content="Wetts&#39;s blog">
<meta property="og:url" content="https://wetts.github.io/page/24/index.html">
<meta property="og:site_name" content="Wetts&#39;s blog">
<meta property="og:description" content="Stay Hungry, Stay Foolish. [build by hexo&#x2F;next&#x2F;gitalk&#x2F;hexo-generator-search&#x2F;LaTeX]">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zhang Wetts">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wetts.github.io/page/24/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Wetts's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Wetts's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/wetts" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">Java虚拟机学习-2.垃圾收集算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-07 22:56:20" itemprop="dateCreated datePublished" datetime="2017-01-07T22:56:20+08:00">2017-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8022293">http://blog.csdn.net/java2000_wl/article/details/8022293</a></p>
<h2 id="跟踪收集器"><a href="#跟踪收集器" class="headerlink" title="跟踪收集器"></a>跟踪收集器</h2><p>跟踪收集器采用的为集中式的管理方式，全局记录对象之间的引用状态，执行时从一些列GC Roots的对象做为起点，从这些节点向下开始进行搜索所有的引用链，当一个对象到GC Roots 没有任何引用链时，则证明此对象是不可用的。</p>
<p>下图中，对象Object6、Object7、Object8虽然互相引用，但他们的GC Roots是不可到达的，所以它们将会被判定为是可回收的对象。</p>
<p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/GC.png" alt="GC"></p>
<p>可作为GC Roots 的对象包括：</p>
<ul>
<li>虚拟机栈(栈帧中的本地变量表)中的引用对象。</li>
<li>方法区中的类静态属性引用的对象</li>
<li>方法区中的常量引用的对象</li>
<li>本地方法栈中JNI的引用对象。</li>
</ul>
<p>主要有复制、标记清除、标记压缩三种实现算法。</p>
<h3 id="标记-清除算法"><a href="#标记-清除算法" class="headerlink" title="标记 - 清除算法"></a>标记 - 清除算法</h3><p>标记清除算法是最基础的收集算法，其他收集算法都是基于这种思想。标记清除算法分为“标记”和“清除”两个阶段：首先标记出需要回收的对象，标记完成之后统一清除对象。</p>
<p>它的主要缺点：</p>
<ol>
<li>标记和清除过程效率不高</li>
<li>标记清除之后会产生大量不连续的内存碎片。</li>
</ol>
<p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95.png" alt="标记-清除算法"></p>
<h3 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h3><p>它将可用内存容量划分为大小相等的两块，每次只使用其中的一块。当这一块用完之后，就将还存活的对象复制到另外一块上面，然后在把已使用过的内存空间一次清理掉。这样使得每次都是对其中的一块进行内存回收，不会产生碎片等情况，只要移动堆订的指针，按顺序分配内存即可，实现简单，运行高效。</p>
<p>主要缺点：</p>
<ol>
<li>内存缩小为原来的一半。</li>
</ol>
<p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95.png" alt="复制算法"></p>
<h3 id="标记-整理算法"><a href="#标记-整理算法" class="headerlink" title="标记 - 整理算法"></a>标记 - 整理算法</h3><p>标记操作和“标记-清除”算法一致，后续操作不只是直接清理对象，而是在清理无用对象完成后让所有存活的对象都向一端移动，并更新引用其对象的指针。</p>
<p>主要缺点：</p>
<ol>
<li>在标记-清除的基础上还需进行对象的移动，成本相对较高，好处则是不会产生内存碎片。</li>
</ol>
<p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86%E7%AE%97%E6%B3%95.png" alt="标记-整理算法"></p>
<h2 id="引用计数收集器"><a href="#引用计数收集器" class="headerlink" title="引用计数收集器"></a>引用计数收集器</h2><p>引用计数收集器采用的是分散式管理方式，通过计数器记录对象是否被引用。当计数器为0时说明此对象不在被使用，可以被回收。</p>
<p>主要缺点：</p>
<ol>
<li>循环引用的场景下无法实现回收，例如下面的图中，ObjectC和ObjectB相互引用，那么ObjectA即便释放了对ObjectC、ObjectB的引用，也无法回收。sunJDK在实现GC时未采用这种方式。</li>
</ol>
<p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-2.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="引用计数收集器"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-1.%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%81%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-1.%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%81%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">Java虚拟机学习-1.体系结构、内存模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-07 22:00:17" itemprop="dateCreated datePublished" datetime="2017-01-07T22:00:17+08:00">2017-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8009362">http://blog.csdn.net/java2000_wl/article/details/8009362</a></p>
<h2 id="Java技术体系模块图"><a href="#Java技术体系模块图" class="headerlink" title="Java技术体系模块图"></a>Java技术体系模块图</h2><p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-1.%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%81%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/Java%E4%BD%93%E7%B3%BB%E5%9B%BE.png" alt="Java体系图"></p>
<h2 id="JVM内存区域模型"><a href="#JVM内存区域模型" class="headerlink" title="JVM内存区域模型"></a>JVM内存区域模型</h2><p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-1.%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%81%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/JVM%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E6%A8%A1%E5%9E%8B.png" alt="JVM内存区域模型"></p>
<h3 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h3><p>也称”永久代”、“非堆”，它用于存储虚拟机加载的类信息、常量、静态变量、是 <strong>各个线程共享的内存区域</strong>。默认最小值为16MB，最大值为64MB，可以通过<code>-XX:PermSize</code> 和 <code>-XX:MaxPermSize</code> 参数限制方法区的大小。</p>
<p>运行时常量池：是方法区的一部分，Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是常量池，用于存放编译器生成的各种符号引用，这部分内容将在类加载后放到方法区的运行时常量池中。</p>
<h3 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h3><p>描述的是java 方法执行的内存模型：每个方法被执行的时候都会创建一个“栈帧”用于存储局部变量表(包括参数)、操作栈、方法出口等信息。每个方法被调用到执行完的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。声明周期与线程相同，是 <strong>线程私有的</strong>。</p>
<p>局部变量表存放了编译器可知的各种基本数据类型(boolean、byte、char、short、int、float、long、double)、对象引用(引用指针，并非对象本身)，其中64位长度的long和double类型的数据会占用2个局部变量的空间，其余数据类型只占1个。局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在栈帧中分配多大的局部变量是完全确定的，在运行期间栈帧不会改变局部变量表的大小空间。</p>
<h3 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h3><p>与虚拟机栈基本类似，区别在于虚拟机栈为虚拟机执行的java方法服务，而本地方法栈则是为Native方法服务。</p>
<h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>也叫做java 堆、GC堆是java虚拟机所管理的内存中最大的一块内存区域，也是被各个线程共享的内存区域，在JVM启动时创建。该内存区域存放了对象实例及数组(所有new的对象)。其大小通过<code>-Xms</code>(最小值)和<code>-Xmx</code>(最大值)参数设置，<code>-Xms</code>为JVM启动时申请的最小内存，默认为操作系统物理内存的1/64但小于1G，<code>-Xmx</code>为JVM可申请的最大内存，默认为物理内存的1/4但小于1G，默认当空余堆内存小于40%时，JVM会增大Heap到<code>-Xmx</code>指定的大小，可通过<code>-XX:MinHeapFreeRation=</code>来指定这个比列；当空余堆内存大于70%时，JVM会减小heap的大小到<code>-Xms</code>指定的大小，可通过<code>XX:MaxHeapFreeRation=</code>来指定这个比列，对于运行系统，为避免在运行时频繁调整Heap的大小，通常<code>-Xms</code>与<code>-Xmx</code>的值设成一样。</p>
<p>由于现在收集器都是采用分代收集算法，堆被划分为新生代和老年代。新生代主要存储新创建的对象和尚未进入老年代的对象。老年代存储经过多次新生代GC(Minor GC)任然存活的对象。</p>
<h4 id="新生代："><a href="#新生代：" class="headerlink" title="新生代："></a>新生代：</h4><p>程序新创建的对象都是从新生代分配内存，新生代由Eden Space和两块相同大小的Survivor Space(通常又称S0和S1或From和To)构成，可通过<code>-Xmn</code>参数来指定新生代的大小，也可以通过<code>-XX:SurvivorRation</code>来调整Eden Space及Survivor Space的大小。</p>
<h4 id="老年代："><a href="#老年代：" class="headerlink" title="老年代："></a>老年代：</h4><p>用于存放经过多次新生代GC任然存活的对象，例如缓存对象，新建的对象也有可能直接进入老年代，主要有两种情况：</p>
<ol>
<li>大对象，可通过启动参数设置<code>-XX:PretenureSizeThreshold=1024</code>(单位为字节，默认为0)来代表超过多大时就不在新生代分配，而是直接在老年代分配。</li>
<li>大的数组对象，切数组中无引用外部对象。<br>老年代所占的内存大小为<code>-Xmx</code>对应的值减去<code>-Xmn</code>对应的值。</li>
</ol>
<p><img src="/2017/01/07/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-1.%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%81%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/%E5%86%85%E5%AD%98%E5%9B%BE.png" alt="内存图"></p>
<h3 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h3><p>是最小的一块内存区域，它的作用是当前线程所执行的字节码的行号指示器，在虚拟机的模型里，字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、异常处理、线程恢复等基础功能都需要依赖计数器完成。</p>
<h2 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h2><p>直接内存并不是虚拟机内存的一部分，也不是Java虚拟机规范中定义的内存区域。jdk1.4中新加入的NIO，引入了通道与缓冲区的IO方式，它可以调用Native方法直接分配堆外内存，这个堆外内存就是本机内存，不会影响到堆内存的大小。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-save%E5%92%8Cinsert%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-save%E5%92%8Cinsert%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">save和insert函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-04 16:11:32" itemprop="dateCreated datePublished" datetime="2017-01-04T16:11:32+08:00">2017-01-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="https://my.oschina.net/u/1590519/blog/342765">https://my.oschina.net/u/1590519/blog/342765</a></p>
<p>当主键”<code>_id</code>“不存在时，都是添加一个新的文档，但主健”<code>_id</code>“存在时，就有些不同了。</p>
<p>mongodb的save和insert函数都可以向collection里插入数据，但两者是有两个区别：</p>
<ol>
<li><p>使用save函数里，如果原来的对象不存在，那他们都可以向collection里插入数据，如果已经存在，save会调用update更新里面的记录，而insert则会忽略操作</p>
</li>
<li><p>insert可以一次性插入一个列表，而不用遍历，效率高，save则需要遍历列表，一个个插入。</p>
</li>
</ol>
<p>看下这两个函数的原型就清楚了，直接输入函数名便可以查看原型，下面标红的部分就是实现了循环，对于远程调用来说，是一性次将整个列表post过来让mongodb去自己处理，效率会高些</p>
<h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.insert</span><br><span class="line">function (obj, _allow_dot) &#123;</span><br><span class="line">    if (!obj) &#123;</span><br><span class="line">        throw &quot;no object passed to insert!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!_allow_dot) &#123;</span><br><span class="line">        this._validateForStorage(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof obj._id == &quot;undefined&quot; &amp;&amp; !Array.isArray(obj)) &#123;</span><br><span class="line">        var tmp = obj;</span><br><span class="line">        obj = &#123;_id:new ObjectId&#125;;</span><br><span class="line">        for (var key in tmp) &#123;</span><br><span class="line">            obj[key] = tmp[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this._db._initExtraInfo();</span><br><span class="line">    this._mongo.insert(this._fullName, obj);</span><br><span class="line">    this._lastID = obj._id;</span><br><span class="line">    this._db._getExtraInfo(&quot;Inserted&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="save"><a href="#save" class="headerlink" title="save"></a>save</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.save</span><br><span class="line">function (obj) &#123;</span><br><span class="line">    if (obj == null || typeof obj == &quot;undefined&quot;) &#123;</span><br><span class="line">        throw &quot;can&#x27;t save a null&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof obj == &quot;number&quot; || typeof obj == &quot;string&quot;) &#123;</span><br><span class="line">        throw &quot;can&#x27;t save a number or string&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof obj._id == &quot;undefined&quot;) &#123;</span><br><span class="line">        obj._id = new ObjectId;</span><br><span class="line">        return this.insert(obj);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return this.update(&#123;_id:obj._id&#125;, obj, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-references/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-references/" class="post-title-link" itemprop="url">MongoDB-references</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-03 22:25:44" itemprop="dateCreated datePublished" datetime="2017-01-03T22:25:44+08:00">2017-01-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/database-references/">https://docs.mongodb.com/manual/reference/database-references/</a></p>
<p>MongoDB does not support joins. In MongoDB some data is denormalized, or stored with related data in documents to remove the need for joins. However, in some cases it makes sense to store related information in separate documents, typically in different collections or databases.</p>
<p>MongoDB applications use one of two methods for relating documents:</p>
<ul>
<li>Manual references where you save the <code>_id</code> field of one document in another document as a reference. Then your application can run a second query to return the related data. These references are simple and sufficient for most use cases.</li>
<li>DBRefs are references from one document to another using the value of the first document’s <code>_id</code> field, collection name, and, optionally, its database name. By including these names,  <strong>DBRefs allow documents located in multiple collections to be more easily linked with documents from a single collection.</strong></li>
</ul>
<p>To resolve DBRefs, your application must perform additional queries to return the referenced documents. Many drivers have helper methods that form the query for the DBRef automatically. The drivers do not automatically resolve DBRefs into documents.</p>
<p>DBRefs provide a common format and type to represent relationships among documents. The DBRef format also provides common semantics for representing links between documents if your database must interact with multiple frameworks and tools.</p>
<p>Unless you have a compelling reason to use DBRefs, use manual references instead.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/03/%E5%B7%A5%E7%A8%8B/%E6%8E%A5%E5%8F%A3/%E6%8E%A5%E5%8F%A3%E5%88%97%E8%A1%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/03/%E5%B7%A5%E7%A8%8B/%E6%8E%A5%E5%8F%A3/%E6%8E%A5%E5%8F%A3%E5%88%97%E8%A1%A8/" class="post-title-link" itemprop="url">接口列表</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-03 22:05:57" itemprop="dateCreated datePublished" datetime="2017-01-03T22:05:57+08:00">2017-01-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8E%A5%E5%8F%A3/" itemprop="url" rel="index"><span itemprop="name">接口</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="天气接口"><a href="#天气接口" class="headerlink" title="天气接口"></a>天气接口</h3><ul>
<li><code>http://wthrcdn.etouch.cn/weather_mini?citykey=101010100</code></li>
<li><code>http://wthrcdn.etouch.cn/weather_mini?city=北京</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/01/%E7%B3%BB%E7%BB%9F&%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-HTTP%E7%8A%B6%E6%80%81%E7%A0%81-499/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/01/%E7%B3%BB%E7%BB%9F&%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-HTTP%E7%8A%B6%E6%80%81%E7%A0%81-499/" class="post-title-link" itemprop="url">Nginx-HTTP状态码-499</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-01 08:54:17" itemprop="dateCreated datePublished" datetime="2017-01-01T08:54:17+08:00">2017-01-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://www.lc365.net/blog/b/23997/">http://www.lc365.net/blog/b/23997/</a></p>
<p>日志记录中HTTP状态码出现499错误有多种情况，我遇到的一种情况是nginx反代到一个永远打不开的后端，就这样了，日志状态记录是499、发送字节数是0。</p>
<p>499错误是什么？让我们看看NGINX的源码中的定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ngx_string(ngx_http_error_495_page), /* 495, https certificate error */</span><br><span class="line">ngx_string(ngx_http_error_496_page), /* 496, https no certificate */</span><br><span class="line">ngx_string(ngx_http_error_497_page), /* 497, http to https */</span><br><span class="line">ngx_string(ngx_http_error_404_page), /* 498, canceled */</span><br><span class="line">ngx_null_string,                    /* 499, client has closed connection */</span><br></pre></td></tr></table></figure>
<p>可以看到，499对应的是 “client has closed connection”。这很有可能是因为服务器端处理的时间过长，客户端“不耐烦”了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-$where%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-$where%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">MongoDB-常用命令-$where查询</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-31 13:57:22" itemprop="dateCreated datePublished" datetime="2016-12-31T13:57:22+08:00">2016-12-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.163.com/wm_at163/blog/static/132173490201252610424458/">http://blog.163.com/wm_at163/blog/static/132173490201252610424458/</a></p>
<p>有时候，键值对的查询方式并不能满足我们的需求，我们有如下一个集合：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.find()</span><br><span class="line">&#123; “_id” : ObjectId(“4e9165cf717ed94f8289ac0c”), “bar” : “baz”, “count” : 35 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e916661739f1da5452a4dfe”), “bar” : “bazz”, “count” : 3 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e9165cf717ed94f8289ac0d”), “bar” : “baz”, “count” : 35 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928bf8735a86e2c6f848ed”), “apple” : 1, “banana” : 6, “peach” : 3 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928c17735a86e2c6f848ee”), “apple” : 1, “spinach” : 4, “watermelon” : 4 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928d8a735a86e2c6f848ef”), “bar” : “baz”, “banana” : “baz” &#125;</span><br></pre></td></tr></table></figure>
<p>需要返回有两个字段相同的文档，也就是要返回如下文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; “_id” : ObjectId(“4e928c17735a86e2c6f848ee”), “apple” : 1, “spinach” : 4, “watermelon” : 4 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928d8a735a86e2c6f848ef”), “bar” : “baz”, “banana” : “baz” &#125;</span><br></pre></td></tr></table></figure>
<p>就需要使用”$where“并借助javascript来做了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.find(&#123;“$where”:function()&#123;</span><br><span class="line">… for(var current in this)&#123;</span><br><span class="line">…   for(var other in this)&#123;</span><br><span class="line">…     if(current != other &amp;&amp; this[current] == this[other])&#123;</span><br><span class="line">…       return true;</span><br><span class="line">…     &#125;</span><br><span class="line">…   &#125;</span><br><span class="line">… &#125;</span><br><span class="line">… return false;</span><br><span class="line">… &#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>如果返回true，文档作为结果的一部分被返回；如果为false，则不会返回。</p>
<p>$where查询有以下几种写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.find(&#123;“$where”:”this.x+this.y==10″&#125;)</span><br><span class="line">&gt; db.foo.find(&#123;“$where”:”function()&#123;return this.x+this.y==10;&#125;”&#125;)</span><br></pre></td></tr></table></figure>
<p>tips：不是非常必要时，一定要避免使用”$where”查询，因为效率太低，相当的。文档在MongoDB中是以BSON格式保存的，在$where查询时，每个文档都要从BSON转换为javascript对象然后再通过”$where”中的表达式来运行。有时可以将常规查询作为前置过滤，再使用”$where”查询对结果进行调优</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-_id%E5%92%8CObjectId/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-_id%E5%92%8CObjectId/" class="post-title-link" itemprop="url">MongoDB-`_id`和ObjectId</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-31 13:21:11" itemprop="dateCreated datePublished" datetime="2016-12-31T13:21:11+08:00">2016-12-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://book.51cto.com/art/201112/307016.htm">http://book.51cto.com/art/201112/307016.htm</a></p>
<h2 id="id和ObjectId"><a href="#id和ObjectId" class="headerlink" title="_id和ObjectId"></a><code>_id和ObjectId</code></h2><p>MongoDB 中存储的文档必须有一个”<code>_id</code>“ 键。这个键的值可以是任何类型的，默认是个ObjectId 对象。在一个集合里面，每个文档都有唯一的”<code>_id</code>“ 值，来确保集合里面每个文档都能被唯一标识。如果有两个集合的话，两个集合可以都有一个值为123 的”<code>_id</code>“ 键，但是每个集合里面只能有一个”<code>_id</code>“ 是123 的文档。</p>
<h3 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h3><p>ObjectId 是”<code>_id</code>“ 的默认类型。它设计成轻量型的，不同的机器都能用全局唯一的同种方法方便地生成它。这是MongoDB 采用ObjectId，而不是其他比较常规的做法（比如自动增加的主键）的主要原因，因为在多个服务器上同步自动增加主键值既费力还费时。MongoDB 从一开始就设计用来作为分布式数据库，处理多个节点是一个核心要求。后面会看到ObjectId 类型在分片环境中要容易生成得多。</p>
<p>ObjectId 使用12 字节的存储空间，每个字节两位十六进制数字，是一个24 位的字符串。由于看起来很长，不少人会觉得难以处理。但关键是要知道这个长长的ObjectId 是实际存储数据的两倍长。</p>
<p>如果快速连续创建多个ObjectId，会发现每次只有最后几位数字有变化。另外，中间的几位数字也会变化（要是在创建的过程中停顿几秒钟）。这是ObjectId 的创建方式导致的。12 字节按照如下方式生成：</p>
<p><img src="/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-_id%E5%92%8CObjectId/1.png" alt="1"></p>
<h4 id="ObjectId生成规则"><a href="#ObjectId生成规则" class="headerlink" title="ObjectId生成规则"></a>ObjectId生成规则</h4><h5 id="4字节：UNIX时间戳"><a href="#4字节：UNIX时间戳" class="headerlink" title="4字节：UNIX时间戳"></a>4字节：UNIX时间戳</h5><p>前4 个字节是从标准纪元开始的时间戳，单位为秒。这会带来一些有用的属性。时间戳，与随后的 5 个字节组合起来，提供了秒级别的唯一性。</p>
<p>由于时间戳在前，这意味着ObjectId 大致会按照插入的顺序排列。这对于某些方面很有用，如将其作为索引提高效率，但是这个是没有保证的，仅仅是“大致”。</p>
<p>这4 个字节也隐含了文档创建的时间。绝大多数驱动都会公开一个方法从ObjectId 获取这个信息。</p>
<p>因为使用的是当前时间，很多用户担心要对服务器进行时间同步。其实没有这个必要，因为时间戳的实际值并不重要，只要其总是不停增加就好了（每秒一次）。</p>
<h5 id="3字节：表示运行MongoDB的机器"><a href="#3字节：表示运行MongoDB的机器" class="headerlink" title="3字节：表示运行MongoDB的机器"></a>3字节：表示运行MongoDB的机器</h5><p>接下来的3 字节是所在主机的唯一标识符。通常是机器主机名的散列值。这样就可以确保不同主机生成不同的ObjectId，不产生冲突。</p>
<h5 id="2字节：表示生成此-id的进程"><a href="#2字节：表示生成此-id的进程" class="headerlink" title="2字节：表示生成此_id的进程"></a>2字节：表示生成此_id的进程</h5><p>为了确保在同一台机器上并发的多个进程产生的ObjectId 是唯一的，接下来的两字节来自产生ObjectId 的进程标识符（PID）。</p>
<h5 id="3字节：由一个随机数开始的计数器生成的值"><a href="#3字节：由一个随机数开始的计数器生成的值" class="headerlink" title="3字节：由一个随机数开始的计数器生成的值"></a>3字节：由一个随机数开始的计数器生成的值</h5><p>前9 字节保证了同一秒钟不同机器不同进程产生的ObjectId 是唯一的。后3 字节就是一个自动增加的计数器，确保相同进程同一秒产生的ObjectId 也是不一样的。同一秒钟最多允许每个进程拥有2563（16 777 216）个不同的ObjectId。</p>
<h3 id="自动生成-id"><a href="#自动生成-id" class="headerlink" title="自动生成_id"></a>自动生成_id</h3><p>前面讲到，如果插入文档的时候没有”<code>_id</code>“ 键，系统会自动帮你创建一个。可以由MongoDB 服务器来做这件事情，但通常会在客户端由驱动程序完成。理由如下。</p>
<p>虽然ObjectId 设计成轻量型的，易于生成，但是毕竟生成的时候还是产生开销。在客户端生成体现了MongoDB 的设计理念：能从服务器端转移到驱动程序来做的事，就尽量转移。这种理念背后的原因是，即便是像MongoDB 这样的可扩展数据库，扩展应用层也要比扩展数据库层容易得多。将事务交由客户端来处理，就减轻了数据库扩展的负担。</p>
<p>在客户端生成ObjectId，驱动程序能够提供更加丰富的API。例如，驱动程序可以有自己的insert 方法，可以返回生成的ObjectId，也可以直接将其插入文档。如果驱动程序允许服务器生成ObjectId，那么将需要单独的查询，以确定插入的文档中的”<code>_id</code>“ 值。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" class="post-title-link" itemprop="url">MongoDB-常用命令-增删改查</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-31 10:21:13" itemprop="dateCreated datePublished" datetime="2016-12-31T10:21:13+08:00">2016-12-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p><code>db.collection.insert()</code></p>
<p><img src="/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/%E6%8F%92%E5%85%A5.png" alt="插入"></p>
<p>存储在MongoDB集合中的每个文档（document）都有一个默认的主键_id，这个主键名称是固定的，它可以是MongoDB支持的任何数据类型，默认是ObjectId</p>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p><code>db.collection.find()</code></p>
<h3 id="数组查询"><a href="#数组查询" class="headerlink" title="数组查询"></a>数组查询</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$all</td>
<td align="center">通过多个元素来匹配数组。</td>
</tr>
<tr>
<td align="center">$size</td>
<td align="center">查询特定长度的数组。</td>
</tr>
<tr>
<td align="center">$slice</td>
<td align="center">返回数组的一个子集合。</td>
</tr>
</tbody></table>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p><code>db.food.find()</code></p>
<p>数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;001&quot;, &quot;fruits&quot; : [ &quot;苹果&quot;, &quot;香蕉&quot;, &quot;橘子&quot; ] &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;002&quot;, &quot;fruits&quot; : [ &quot;苹果&quot;, &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;003&quot;, &quot;fruits&quot; : [ &quot;圣女果&quot;, &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br></pre></td></tr></table></figure>

<h5 id="all"><a href="#all" class="headerlink" title="$all"></a>$all</h5><p>查询水果列表中既有苹果又有桃子的食品：<code>db.food.find(&#123;&quot;fruits&quot;:&#123;&quot;$all&quot;:[&quot;苹果&quot;,&quot;桃子&quot;]&#125;&#125;) --这是AND的关系</code></p>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;002&quot;, &quot;fruits&quot; : [ &quot;苹果&quot;, &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br></pre></td></tr></table></figure>

<p>查询水果列表中下标为1的元素是梨子的食品：<code>db.food.find(&#123;&quot;fruits.1&quot;:&quot;梨子&quot;&#125;)</code></p>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;002&quot;, &quot;fruits&quot; : [ &quot;苹果&quot;, &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;003&quot;, &quot;fruits&quot; : [ &quot;圣女果&quot;, &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br></pre></td></tr></table></figure>

<h5 id="size"><a href="#size" class="headerlink" title="$size"></a>$size</h5><p>数组包含3个元素的文档：<code>db.food.find(&#123;&quot;fruits&quot;:&#123;&quot;$size&quot;:3&#125;&#125;)</code></p>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;001&quot;, &quot;fruits&quot; : [ &quot;苹果&quot;, &quot;香蕉&quot;, &quot;橘子&quot; ] &#125;</span><br></pre></td></tr></table></figure>

<h5 id="slice"><a href="#slice" class="headerlink" title="$slice"></a>$slice</h5><p>返回lists后3个元素：<code>db.test.find(&#123;&#125;,&#123;&quot;lists&quot;:&#123;&quot;$slice&quot;:-3&#125;&#125;)</code></p>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;001&quot;, &quot;fruits&quot; : [ &quot;苹果&quot;, &quot;香蕉&quot;, &quot;橘子&quot; ] &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;002&quot;, &quot;fruits&quot; : [ &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;003&quot;, &quot;fruits&quot; : [ &quot;梨子&quot;, &quot;橘子&quot;, &quot;桃子&quot; ] &#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><code>db.collection.update(&lt;query&gt;, &lt;update&gt;, upsert:&lt;boolean&gt;, multi:&lt;boolean&gt;) </code></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">query</td>
<td align="center">document</td>
<td align="center">要修改哪些的查询条件，类似于SQL 的 where</td>
</tr>
<tr>
<td align="center">update</td>
<td align="center">document</td>
<td align="center">要修改的字段对应的值</td>
</tr>
<tr>
<td align="center">upsert</td>
<td align="center">boolean</td>
<td align="center">可选的，默认值是false。如果根据查询条件没找到对应的文档，如果设置为true，相当于执行insert，如果设置为false,不做任何的操作。</td>
</tr>
<tr>
<td align="center">multi</td>
<td align="center">boolean</td>
<td align="center">可选的，默认值是false。如果根据查询条件找到对应的多条记录是，如果设置为false时，只修改第一条，如果设置为true，全部更新。</td>
</tr>
</tbody></table>
<h3 id="对单个字段进行修改"><a href="#对单个字段进行修改" class="headerlink" title="对单个字段进行修改"></a>对单个字段进行修改</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$inc</td>
<td align="center">根据要添加的值递增该字段的值。</td>
</tr>
<tr>
<td align="center">$mul</td>
<td align="center">将该字段的值乘以指定的值</td>
</tr>
<tr>
<td align="center">$rename</td>
<td align="center">重命名字段</td>
</tr>
<tr>
<td align="center">$setOnInsert</td>
<td align="center">操作时,操作给相应的字段赋值</td>
</tr>
<tr>
<td align="center">$set</td>
<td align="center">用来指定一个键的值，如果不存在则创建它</td>
</tr>
<tr>
<td align="center">$unset</td>
<td align="center">用来指定一个键的值，如果不存在不创建创建它</td>
</tr>
<tr>
<td align="center">$min</td>
<td align="center">只有当指定的值小于现有字段值时才更新该字段。</td>
</tr>
<tr>
<td align="center">$max</td>
<td align="center">只有当指定的值大于现有字段值时才更新该字段。</td>
</tr>
<tr>
<td align="center">$currentDate</td>
<td align="center">设置当前日期字段的值，或者作为一个日期或时间戳。</td>
</tr>
</tbody></table>
<h3 id="对数组进行修改"><a href="#对数组进行修改" class="headerlink" title="对数组进行修改"></a>对数组进行修改</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$</td>
<td align="center">作为一个占位符的更新与查询条件在一个更新的第一要素</td>
</tr>
<tr>
<td align="center">$addToSet</td>
<td align="center">将元素添加到数组中，仅当它们在集合中不存在</td>
</tr>
<tr>
<td align="center">$pop</td>
<td align="center">删除数组的第一个或最后一个项</td>
</tr>
<tr>
<td align="center">$pullAll</td>
<td align="center">从数组中移除所有匹配值</td>
</tr>
<tr>
<td align="center">$pull</td>
<td align="center">移除匹配指定查询的所有数组元素</td>
</tr>
<tr>
<td align="center">$pushAll</td>
<td align="center">将所有值添加到数组中（Deprecated since version 2.4: Use the $push operator with $each instead.）</td>
</tr>
<tr>
<td align="center">$push</td>
<td align="center">将值添加到数组中，如果有的数组存在则向数组末尾添加该值，如果数组不存在则创建该数组并保存该值</td>
</tr>
</tbody></table>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p><code>db.collection.remove()</code></p>
<p>删除orders集合的数据，集合还存在，索引都还存在</p>
<h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><p><code>db.collection.drop()</code></p>
<p>集合、索引都不存在了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2016/12/30/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E6%95%B0%E7%BB%84-elemMatch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/30/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E6%95%B0%E7%BB%84-elemMatch/" class="post-title-link" itemprop="url">MongoDB-elemMatch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-30 17:45:41" itemprop="dateCreated datePublished" datetime="2016-12-30T17:45:41+08:00">2016-12-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>$elemMatch</code>是用来匹配数组内的元素的。</p>
<p>与<code>.</code>容易产生混淆。</p>
<h3 id="elemMatch与-对比"><a href="#elemMatch与-对比" class="headerlink" title="$elemMatch与.对比"></a><code>$elemMatch</code>与<code>.</code>对比</h3><h4 id="初始化源数据"><a href="#初始化源数据" class="headerlink" title="初始化源数据"></a>初始化源数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.em.insert(&#123;&quot;arr&quot;:[&#123;&quot;e1&quot;:&quot;a&quot;,&quot;e2&quot;:11&#125;,&#123;&quot;e1&quot;:&quot;b&quot;,&quot;e2&quot;:12&#125;,&#123;&quot;e1&quot;:&quot;c&quot;,&quot;e2&quot;:13&#125;,&#123;&quot;e1&quot;:&quot;d&quot;,&quot;e2&quot;:14&#125;]&#125;)</span><br><span class="line">db.em.insert(&#123;&quot;arr&quot;:[&#123;&quot;e1&quot;:&quot;a&quot;,&quot;e2&quot;:21&#125;,&#123;&quot;e1&quot;:&quot;b&quot;,&quot;e2&quot;:22&#125;,&#123;&quot;e1&quot;:&quot;c&quot;,&quot;e2&quot;:23&#125;,&#123;&quot;e1&quot;:&quot;d&quot;,&quot;e2&quot;:24&#125;]&#125;)</span><br><span class="line">db.em.insert(&#123;&quot;arr&quot;:[&#123;&quot;e1&quot;:&quot;a&quot;,&quot;e2&quot;:31&#125;,&#123;&quot;e1&quot;:&quot;b&quot;,&quot;e2&quot;:32&#125;,&#123;&quot;e1&quot;:&quot;c&quot;,&quot;e2</span><br><span class="line">&quot;:33&#125;,&#123;&quot;e1&quot;:&quot;d&quot;,&quot;e2&quot;:34&#125;]&#125;)</span><br><span class="line">db.em.insert(&#123;&quot;arr&quot;:[&#123;&quot;e1&quot;:&quot;a&quot;,&quot;e2&quot;:41&#125;,&#123;&quot;e1&quot;:&quot;b&quot;,&quot;e2&quot;:42&#125;,&#123;&quot;e1&quot;:&quot;c&quot;,&quot;e2&quot;:43&#125;,&#123;&quot;e1&quot;:&quot;d&quot;,&quot;e2&quot;:44&#125;]&#125;)</span><br><span class="line">db.em.insert(&#123;&quot;arr&quot;:[&#123;&quot;e1&quot;:&quot;a&quot;,&quot;e2&quot;:51&#125;,&#123;&quot;e1&quot;:&quot;b&quot;,&quot;e2&quot;:52&#125;,&#123;&quot;e1&quot;:&quot;c&quot;,&quot;e2&quot;:53&#125;,&#123;&quot;e1&quot;:&quot;d&quot;,&quot;e2&quot;:54&#125;]&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="用-查询"><a href="#用-查询" class="headerlink" title="用.查询"></a>用<code>.</code>查询</h4><p><code>db.em.find(&#123;&quot;arr&quot;:&#123;$elemMatch: &#123;&quot;e1&quot;:&quot;a&quot;,&quot;e2&quot;:32&#125;&#125;&#125;)</code></p>
<p>无结果集</p>
<h4 id="用-elemMatch查询"><a href="#用-elemMatch查询" class="headerlink" title="用$elemMatch查询"></a>用<code>$elemMatch</code>查询</h4><p><code>db.em.find(&#123;&quot;arr.e1&quot;:&quot;a&quot;,&quot;arr.e2&quot;:32&#125;)</code></p>
<p>查询结果如下：<br><img src="/2016/12/30/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E6%95%B0%E7%BB%84-elemMatch/1.png" alt="1"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><code>$elemMatch</code>：数组内单个元素匹配则符合</li>
<li><code>.</code>：数组内多个元素能分别匹配上条件即符合</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/23/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><span class="space">&hellip;</span><a class="page-number" href="/page/69/">69</a><a class="extend next" rel="next" href="/page/25/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhang Wetts"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Zhang Wetts</p>
  <div class="site-description" itemprop="description">Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">687</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">340</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wetts" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wetts" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhang.wetts@163.com" title="E-Mail → mailto:zhang.wetts@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Wetts</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
