<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wetts.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Stay Hungry, Stay Foolish. [build by hexo&#x2F;next&#x2F;gitalk&#x2F;hexo-generator-search&#x2F;LaTeX]">
<meta property="og:type" content="website">
<meta property="og:title" content="Wetts&#39;s blog">
<meta property="og:url" content="https://wetts.github.io/page/25/index.html">
<meta property="og:site_name" content="Wetts&#39;s blog">
<meta property="og:description" content="Stay Hungry, Stay Foolish. [build by hexo&#x2F;next&#x2F;gitalk&#x2F;hexo-generator-search&#x2F;LaTeX]">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zhang Wetts">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wetts.github.io/page/25/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Wetts's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Wetts's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/wetts" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/" class="post-title-link" itemprop="url">MongoDB-结构-存储结构及对空间使用率的影响</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-17 16:23:37" itemprop="dateCreated datePublished" datetime="2017-01-17T16:23:37+08:00">2017-01-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://www.mongoing.com/blog/file-storage">http://www.mongoing.com/blog/file-storage</a></p>
<p>参考：<a target="_blank" rel="noopener" href="http://blog.mlab.com/2014/01/how-big-is-your-mongodb/">http://blog.mlab.com/2014/01/how-big-is-your-mongodb/</a></p>
<h2 id="数据库文件类型"><a href="#数据库文件类型" class="headerlink" title="数据库文件类型"></a>数据库文件类型</h2><p>MongoDB 的数据库文件主要有 3 种：</p>
<ul>
<li>journal 日志文件</li>
<li>namespace 表名文件</li>
<li>data 数据及索引文件</li>
</ul>
<h3 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h3><p>跟一些传统数据库不同，MongoDB 的日志文件只是用来在系统出现宕机时候恢复尚未来得及同步到硬盘的内存数据。日志文件会存放在一个分开的目录下面。启动时候 MongoDB 会自动预先创建 3 个每个为 1G 的日志文件（初始为空）。除非你真的有持续海量数据并发写入，一般来说 3 个 G 已经足够。</p>
<h3 id="命名文件-dbname-ns"><a href="#命名文件-dbname-ns" class="headerlink" title="命名文件 dbname.ns"></a>命名文件 dbname.ns</h3><p>这个文件用来存储整个数据库的集合以及索引的名字。这个文件不大，默认 16M，可以存储 24000 个集合或者索引名以及那些集合和索引在数据文件中得具体位置。通过这个文件 MongoDB 可以知道从哪里去开始寻找或插入集合的数据或者索引数据。这个值可以通过参数调整至2G。</p>
<h3 id="数据文件-dbname-0-dbname-1-…-dbname-n"><a href="#数据文件-dbname-0-dbname-1-…-dbname-n" class="headerlink" title="数据文件 dbname.0, dbname.1,… dbname.n"></a>数据文件 dbname.0, dbname.1,… dbname.n</h3><p>MongoDB 的数据以及索引都存放在一个或者多个 MongoDB 数据文件里。第一个数据文件会以“数据库名.0”命名，如 my-db.0。这个文件默认大小是 64M，在接近用完这个 64M 之前，MongoDB 会提前生成下一个数据文件如 my-db.1。数据文件的大小会 2 倍递增。第二个数据文件的大小为 128M，第三个为 256M。一直到了 2G 以后就会停止，一直按这个 2G 这个大小增加新的文件。</p>
<hr>
<p>当然 MongoDB还 会生成一些临时文件如 <code>_tmp</code> 和 <code>mongod.lock</code>等， 不过他们跟我们的讨论都没有太大相关性。</p>
<h2 id="数据文件结构"><a href="#数据文件结构" class="headerlink" title="数据文件结构"></a>数据文件结构</h2><h3 id="Extent"><a href="#Extent" class="headerlink" title="Extent"></a>Extent</h3><p>在每一个数据文件内，MongoDB 把所存储的 BSON 文档的数据和 B 树索引组织到逻辑容器“Extent”里面。如下图所示（my-db.1 和 my-db.2 是数据库的两个数据文件）：</p>
<p><img src="/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/Extents.png" alt="Extent"></p>
<ul>
<li>一个文件可以有多个 Extent</li>
<li>每一个 Extent 只会包含一个集合的数据或者索引</li>
<li>同一个集合的数据或索引可以分布在多个 Extent 内。这几个 Extent 也可以分步于多个文件内</li>
<li>同一个 Extent 不会又有数据又有索引</li>
</ul>
<h3 id="Record-记录"><a href="#Record-记录" class="headerlink" title="Record 记录"></a>Record 记录</h3><p>在每个 Extent 里面存放有多个”Record“, 每一个记录里包含一个记录头以及 MongoDB 的 BSON 文档，以及一些额外的 padding 空间。Padding 是 MongoDB 在插入记录时额外分配一些未用空间，这样将来文档变大的时候不至于需要把文档迁移到别处。 记录头以整个记录的大小开始，包括该记录自己的位置以及前一个记录和后一个记录的位置。可以想象成一个 Double Linked List。</p>
<p><img src="/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/Record.png" alt="Record"></p>
<h2 id="数据库大小参数"><a href="#数据库大小参数" class="headerlink" title="数据库大小参数"></a>数据库大小参数</h2><p>在之前的基础上，我们可以来理解一下 db.stats() 里面关于空间大小参数的含义。</p>
<h3 id="dataSize"><a href="#dataSize" class="headerlink" title="dataSize"></a>dataSize</h3><p>dataSize 是最接近真实数据大小的一个参数。你可以用来检查你的数据有多少。这个大小包括了数据库（或者集合）的每条记录的总和。注意每条记录除了 BSON 文档外还有 header 及 padding 这些额外开销。所以实际大小会比真正数据所占空间会稍大。</p>
<p>当删除文档的时候，这个参数会相应变小因为它是所有文档数的大小总和。如果你的文档没有删除，只是文档内部的字段被删除或缩小，则不会对 dataSize 有影响。原因就是因为文档所在记录还在，并且整条记录所占空间并无改动，只不过记录内的未用空间变多了而已。</p>
<p><img src="/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/dataSize.png" alt="dataSize"></p>
<h3 id="storageSize"><a href="#storageSize" class="headerlink" title="storageSize"></a>storageSize</h3><p>这个参数等于数据库或者某个集合所有用到的 Data Extents 的总和。注意这个数字会大于 dataSize 因为 Extent 里面会有一些删除文档之后留下来的碎片（deleted）。及时你的 storageSize 大出 dataSize 很多，这个也不一定就是很糟糕的情况。如果有新插入的文档小于或等于碎片的大小，MongoDB 会重新利用这个碎片来存储新的文档。不过在这之前这些碎片将一直会被保留在那里占用空间。由于这个原因，你删除文档的时候这个参数不会变小。</p>
<p><img src="/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/storageSize.png" alt="storageSize"></p>
<p>碎片问题会因为运行的时间变长而变得严重。你可以通过 compact 命令来进行碎片清理或者通过新架一台从机复制所有数据，然后变成主节点的方式来解决这些碎片。</p>
<h3 id="fileSize"><a href="#fileSize" class="headerlink" title="fileSize"></a>fileSize</h3><p>这个参数只在数据库上有效，指的是实际文件系统中用到的文件的大小。它包括所有的数据 Extents 的总和，索引 Extent 的总和，以及一些未被分配的空间。之前提到 MongoDB 会对数据库文件创建时候进行预分配，例如最小就是 64M，哪怕你只有几百个 KB 的数据。所以这个参数可能会比实际的数据大小会大不少。这些额外未用空间是用来保证 MongoDB 可以在新的数据写入时候快速的分配新的 Extent，避免引起磁盘空间分配引起的延迟。</p>
<p><img src="/2017/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E7%BB%93%E6%9E%84-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AF%B9%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E7%9A%84%E5%BD%B1%E5%93%8D/fileSize.png" alt="fileSize"></p>
<p>值得注意的是，当你删除文档，或甚至集合和索引，这个参数不会变小。换句话说，数据库所使用的硬盘空间只会上升（或者不变），而不会因为删除数据而变小。当然需要知道的是这并不就意味着浪费，只是说有很多预留空间而已。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/14/%E5%B7%A5%E5%85%B7/git/github%E8%A2%AB%E5%A2%99%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/14/%E5%B7%A5%E5%85%B7/git/github%E8%A2%AB%E5%A2%99%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/" class="post-title-link" itemprop="url">github被墙设置代理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-14 13:27:41" itemprop="dateCreated datePublished" datetime="2017-01-14T13:27:41+08:00">2017-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>git config --global http.proxy &quot;localhost:8787&quot;</code></p>
<p>端口可以设置为Lantern的代理端口</p>
<p>所以需要默认不设置代理：</p>
<p><code>git config --global --unset http.proxy</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/14/%E7%B3%BB%E7%BB%9F%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-%E9%85%8D%E7%BD%AE-%E9%99%90%E5%88%B6IP%E8%AE%BF%E9%97%AE%E7%9A%84%E5%90%84%E7%A7%8D%E6%83%85%E5%86%B5%E5%85%A8%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/14/%E7%B3%BB%E7%BB%9F%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-%E9%85%8D%E7%BD%AE-%E9%99%90%E5%88%B6IP%E8%AE%BF%E9%97%AE%E7%9A%84%E5%90%84%E7%A7%8D%E6%83%85%E5%86%B5%E5%85%A8%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">Nginx-配置-限制IP访问的各种情况全解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-14 12:37:22" itemprop="dateCreated datePublished" datetime="2017-01-14T12:37:22+08:00">2017-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://www.jb51.net/article/71148.htm">http://www.jb51.net/article/71148.htm</a></p>
<h2 id="限制某个IP同一时间段的访问次数"><a href="#限制某个IP同一时间段的访问次数" class="headerlink" title="限制某个IP同一时间段的访问次数"></a>限制某个IP同一时间段的访问次数</h2><p>如何设置能限制某个IP某一时间段的访问次数是一个让人头疼的问题，特别面对恶意的ddos攻击的时候。其中CC攻击（Challenge Collapsar）是DDOS（分布式拒绝服务）的一种，也是一种常见的网站攻击方法，攻击者通过代理服务器或者肉鸡向向受害主机不停地发大量数据包， 造成对方服务器资源耗尽，一直到宕机崩溃。</p>
<p>cc攻击一般就是使用有限的ip数对服务器频繁发送数据来达到攻击的目的，nginx可以通过HttpLimitReqModul和HttpLimitZoneModule配置来限制ip在同一时间段的访问次数来防cc攻击。</p>
<p>HttpLimitReqModul用来限制连单位时间内连接数的模块，使用limit_req_zone和limit_req指令配合使用来达到限制。一旦并发连接超过指定数量，就会返回503错误。</p>
<p>HttpLimitConnModul用来限制单个ip的并发连接数，使用limit_zone和limit_conn指令</p>
<p>这两个模块的区别前一个是对一段时间内的连接数限制，后者是对同一时刻的连接数限制</p>
<h3 id="HttpLimitReqModul-限制某一段时间内同一ip访问数实例"><a href="#HttpLimitReqModul-限制某一段时间内同一ip访问数实例" class="headerlink" title="HttpLimitReqModul 限制某一段时间内同一ip访问数实例"></a>HttpLimitReqModul 限制某一段时间内同一ip访问数实例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">  ...</span><br><span class="line">  #定义一个名为allips的limit_req_zone用来存储session，大小是10M内存，</span><br><span class="line">  #以$binary_remote_addr 为key,限制平均每秒的请求为20个，</span><br><span class="line">  #1M能存储16000个状态，rete的值必须为整数，</span><br><span class="line">  #如果限制两秒钟一个请求，可以设置成30r/m</span><br><span class="line">  limit_req_zone $binary_remote_addr zone=allips:10m rate=20r/s;</span><br><span class="line">  ...</span><br><span class="line">  server&#123;</span><br><span class="line">    ...</span><br><span class="line">    location &#123;</span><br><span class="line">      ...</span><br><span class="line">      #限制每ip每秒不超过20个请求，漏桶数burst为5</span><br><span class="line">      #brust的意思就是，如果第1秒、2,3,4秒请求为19个，</span><br><span class="line">      #第5秒的请求为25个是被允许的。</span><br><span class="line">      #但是如果你第1秒就25个请求，第2秒超过20的请求返回503错误。</span><br><span class="line">      #nodelay，如果不设置该选项，严格使用平均速率限制请求数，</span><br><span class="line">      #第1秒25个请求时，5个请求放到第2秒执行，</span><br><span class="line">      #设置nodelay，25个请求将在第1秒执行。</span><br><span class="line">      limit_req zone=allips burst=5 nodelay;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpLimitZoneModule-限制并发连接数实例"><a href="#HttpLimitZoneModule-限制并发连接数实例" class="headerlink" title="HttpLimitZoneModule 限制并发连接数实例"></a>HttpLimitZoneModule 限制并发连接数实例</h3><p>limit_zone只能定义在http作用域，limit_conn可以定义在http server location作用域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">  ...</span><br><span class="line">  #定义一个名为one的limit_zone,大小10M内存来存储session，</span><br><span class="line">  #以$binary_remote_addr 为key</span><br><span class="line">  #nginx 1.18以后用limit_conn_zone替换了limit_conn</span><br><span class="line">  #且只能放在http作用域</span><br><span class="line">  limit_conn_zone  one $binary_remote_addr 10m;</span><br><span class="line">  ...</span><br><span class="line">  server&#123;</span><br><span class="line">    ...</span><br><span class="line">    location &#123;</span><br><span class="line">      ...</span><br><span class="line">      limit_conn one 20;     #连接数限制</span><br><span class="line">      #带宽限制,对单个连接限数，如果一个ip两个连接，就是500x2k</span><br><span class="line">      limit_rate 500k;     </span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="服务器全局限IP"><a href="#服务器全局限IP" class="headerlink" title="服务器全局限IP"></a>服务器全局限IP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#vi nginx.conf</span><br><span class="line">  allow 10.57.22.172;</span><br><span class="line">  deny all;</span><br></pre></td></tr></table></figure>

<h2 id="指定目录的IP访问限制"><a href="#指定目录的IP访问限制" class="headerlink" title="指定目录的IP访问限制"></a>指定目录的IP访问限制</h2><p>实现重点</p>
<p>正则表达式中()和|的使用，（）代表一个原则，|代表或</p>
<p>nginx的location匹配规则中，有一条按照文件顺序进行正则匹配(ps:可以把需要匹配的目录放置在server模块开始的位置)</p>
<p>allow和deny的使用</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>目录结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">根目录/srv/</span><br><span class="line">test1 / --  hello.php</span><br><span class="line">test2/  --  hello.php</span><br><span class="line">test3/  --  hello.php</span><br><span class="line">test4/  --  &#123;hello.php,1.php,2.php&#125;</span><br></pre></td></tr></table></figure>

<h3 id="访问需求"><a href="#访问需求" class="headerlink" title="访问需求"></a>访问需求</h3><p>对于test1,test2目录，只允许指定的192.168.1.101ip地址访问，禁止其它ip访问</p>
<p>对于其他目录的php程序，所有ip地址均可以访问</p>
<p>实现的nginx配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#指定目录实行白名单访问机制</span><br><span class="line">location ~ ^/(test1|test2)/ &#123;</span><br><span class="line">  allow 192.168.1.101;</span><br><span class="line">  deny all;</span><br><span class="line"></span><br><span class="line">  root /srv/;  </span><br><span class="line">  fastcgi_param  HTTPS  on;</span><br><span class="line">    include /etc/nginx/fastcgi_params;  </span><br><span class="line">    fastcgi_pass  php5_fpm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># proxy the PHP scripts to fpm</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">root /srv/;  </span><br><span class="line">fastcgi_param  HTTPS  on;</span><br><span class="line">  include /etc/nginx/fastcgi_params;  </span><br><span class="line">  fastcgi_pass  php5_fpm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项:"></a>注意事项:</h3><ol>
<li>deny 一定要加一个ip，否则直接跳转到403,不往下执行了;如果403默认页是同一域名下，会造成死循环访问；</li>
<li>allow的ip段</li>
</ol>
<p>  从允许访问的段位从小到大排列,如127.0.0.0/24</p>
<p>  下面才能是10.10.0.0/16</p>
<p>  24表示子网掩码:255.255.255.0</p>
<p>  16表示子网掩码:255.255.0.0</p>
<p>  8表示子网掩码:255.0.0.0</p>
<ol start="3">
<li>deny all;结尾 表示除了上面allow的其他都禁止</li>
</ol>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deny 192.168.1.1;           allow 127.0.0.0/24;           allo w 192.168.0.0/16;           allow 10.10.0.0/16;           deny all;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/" class="post-title-link" itemprop="url">Redis-数据结构-zset</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-13 16:05:13" itemprop="dateCreated datePublished" datetime="2017-01-13T16:05:13+08:00">2017-01-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://redisbook.readthedocs.io/en/latest/datatype/sorted_set.html">http://redisbook.readthedocs.io/en/latest/datatype/sorted_set.html</a></p>
<h2 id="有序集"><a href="#有序集" class="headerlink" title="有序集"></a>有序集</h2><p>REDIS_ZSET（有序集）是 ZADD、ZCOUNT 等命令的操作对象，它使用 REDIS_ENCODING_ZIPLIST 和 REDIS_ENCODING_SKIPLIST 两种方式编码：</p>
<p><img src="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/zset.png" alt="zset"></p>
<h2 id="编码的选择"><a href="#编码的选择" class="headerlink" title="编码的选择"></a>编码的选择</h2><p>在通过 ZADD 命令添加第一个元素到空 key 时，程序通过检查输入的第一个元素来决定该创建什么编码的有序集。</p>
<p>如果第一个元素符合以下条件的话，就创建一个 REDIS_ENCODING_ZIPLIST 编码的有序集：</p>
<ul>
<li>服务器属性 server.zset_max_ziplist_entries 的值大于 0（默认为 128）。</li>
<li>元素的 member 长度小于服务器属性 server.zset_max_ziplist_value 的值（默认为 64）。</li>
</ul>
<p>否则，程序就创建一个 REDIS_ENCODING_SKIPLIST 编码的有序集。</p>
<h2 id="编码的转换"><a href="#编码的转换" class="headerlink" title="编码的转换"></a>编码的转换</h2><p>对于一个 REDIS_ENCODING_ZIPLIST 编码的有序集，只要满足以下任一条件，就将它转换为 REDIS_ENCODING_SKIPLIST 编码：</p>
<ul>
<li>ziplist 所保存的元素数量超过服务器属性 server.zset_max_ziplist_entries 的值（默认值为 128）</li>
<li>新添加元素的 member 的长度大于服务器属性 server.zset_max_ziplist_value 的值（默认值为 64）</li>
</ul>
<h2 id="ZIPLIST-编码的有序集"><a href="#ZIPLIST-编码的有序集" class="headerlink" title="ZIPLIST 编码的有序集"></a>ZIPLIST 编码的有序集</h2><p>当使用 REDIS_ENCODING_ZIPLIST 编码时，有序集将元素保存到 ziplist 数据结构里面。</p>
<p>其中，每个有序集元素以两个相邻的 ziplist 节点表示，第一个节点保存元素的 member 域，第二个元素保存元素的 score 域。</p>
<p><strong>多个元素之间按 score 值从小到大排序，如果两个元素的 score 相同，那么按字典序对 member 进行对比，决定哪个元素排在前面，哪个元素排在后面。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">          |&lt;--  element 1 --&gt;|&lt;--  element 2 --&gt;|&lt;--   .......   --&gt;|</span><br><span class="line"></span><br><span class="line">+---------+---------+--------+---------+--------+---------+---------+---------+</span><br><span class="line">| ZIPLIST |         |        |         |        |         |         | ZIPLIST |</span><br><span class="line">| ENTRY   | member1 | score1 | member2 | score2 |   ...   |   ...   | ENTRY   |</span><br><span class="line">| HEAD    |         |        |         |        |         |         | END     |</span><br><span class="line">+---------+---------+--------+---------+--------+---------+---------+---------+</span><br><span class="line"></span><br><span class="line">score1 &lt;= score2 &lt;= ...</span><br></pre></td></tr></table></figure>
<p>虽然元素是按 score 域有序排序的，但对 ziplist 的节点指针只能线性地移动，所以在 REDIS_ENCODING_ZIPLIST 编码的有序集中，查找某个给定元素的复杂度为 $O(N)$。</p>
<p>每次执行添加/删除/更新操作都需要执行一次查找元素的操作，因此这些函数的复杂度都不低于 $O(N)$，至于这些操作的实际复杂度，取决于它们底层所执行的 ziplist 操作。</p>
<h2 id="SKIPLIST-编码的有序集"><a href="#SKIPLIST-编码的有序集" class="headerlink" title="SKIPLIST 编码的有序集"></a>SKIPLIST 编码的有序集</h2><p>当使用 REDIS_ENCODING_SKIPLIST 编码时， 有序集元素由 redis.h/zset 结构来保存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 有序集</span><br><span class="line"> */</span><br><span class="line">typedef struct zset &#123;</span><br><span class="line"></span><br><span class="line">    // 字典</span><br><span class="line">    dict *dict;</span><br><span class="line"></span><br><span class="line">    // 跳跃表</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line"></span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure>
<p>zset 同时使用字典和跳跃表两个数据结构来保存有序集元素。</p>
<p>其中，元素的成员由一个 redisObject 结构表示，而元素的 score 则是一个 double 类型的浮点数，字典和跳跃表两个结构通过将指针共同指向这两个值来节约空间（不用每个元素都复制两份）。</p>
<p>下图展示了一个 REDIS_ENCODING_SKIPLIST 编码的有序集：</p>
<p><img src="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/skiplist.png" alt="skiplist"></p>
<p>通过使用字典结构，并将 member 作为键，score 作为值，有序集可以在 $O(1)$ 时间复杂度内：</p>
<ul>
<li>检查给定 member 是否存在于有序集（被很多底层函数使用）；</li>
<li>取出 member 对应的 score 值（实现 ZSCORE 命令）。</li>
</ul>
<p>另一方面，通过使用跳跃表，可以让有序集支持以下两种操作：</p>
<ul>
<li>在 $O(logN)$ 期望时间、$O(N)$ 最坏时间内根据 score 对 member 进行定位（被很多底层函数使用）；</li>
<li>范围性查找和处理操作，这是（高效地）实现 ZRANGE、ZRANK 和 ZINTERSTORE 等命令的关键。</li>
</ul>
<p>通过同时使用字典和跳跃表，有序集可以高效地实现按成员查找和按顺序查找两种操作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/12/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/12/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Redis-保护模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-12 11:54:47" itemprop="dateCreated datePublished" datetime="2017-01-12T11:54:47+08:00">2017-01-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：<a target="_blank" rel="noopener" href="https://redis.io/topics/security">https://redis.io/topics/security</a></p>
<p><strong>Protected mode</strong></p>
<p>Unfortunately many users fail to protect Redis instances from being accessed from external networks. Many instances are simply left exposed on the internet with public IPs. For this reasons since version 3.2.0, when Redis is executed with the default configuration (binding all the interfaces) and without any password in order to access it, it enters a special mode called protected mode. In this mode Redis only replies to queries from the loopback interfaces, and reply to other clients connecting from other addresses with an error, explaining what is happening and how to configure Redis properly.</p>
<p>We expect protected mode to seriously decrease the security issues caused by unprotected Redis instances executed without proper administration, however the system administrator can still ignore the error given by Redis and just disable protected mode or manually bind all the interfaces.</p>
<hr>
<p>Redis 从 3.2 开始加强安全管理，如果 redis 没有设置密码，那么 redis 客户端只能从本地进行访问，如果是从其他机器连接过来访问的，就会报错误。</p>
<p>保护模式下，可以查看参数 <code>protected-mode</code> 值为 yes</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><ol>
<li>为 Redis 设置密码</li>
<li>将 <code>protected-mode</code> 值设置为为 no<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config set protected-mode no</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%91%BD%E4%BB%A4-save%E5%92%8Cinsert%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/04/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%91%BD%E4%BB%A4-save%E5%92%8Cinsert%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">MongoDB-命令-save和insert函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-04 16:11:32" itemprop="dateCreated datePublished" datetime="2017-01-04T16:11:32+08:00">2017-01-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="https://my.oschina.net/u/1590519/blog/342765">https://my.oschina.net/u/1590519/blog/342765</a></p>
<p>当主键”<code>_id</code>“不存在时，都是添加一个新的文档，但主健”<code>_id</code>“存在时，就有些不同了。</p>
<p>mongodb 的 save 和 insert 函数都可以向 collection 里插入数据，但两者是有两个区别：</p>
<ol>
<li><p>使用 save 函数里，如果原来的对象不存在，那他们都可以向 collection 里插入数据，如果已经存在，save 会调用 update 更新里面的记录，而 insert 则会忽略操作</p>
</li>
<li><p>insert 可以一次性插入一个列表，而不用遍历，效率高，save 则需要遍历列表，一个个插入。</p>
</li>
</ol>
<p>看下这两个函数的原型就清楚了，直接输入函数名便可以查看原型，下面标红的部分就是实现了循环，对于远程调用来说，是一性次将整个列表 post 过来让 mongodb 去自己处理，效率会高些</p>
<h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.insert</span><br><span class="line">function (obj, _allow_dot) &#123;</span><br><span class="line">    if (!obj) &#123;</span><br><span class="line">        throw &quot;no object passed to insert!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!_allow_dot) &#123;</span><br><span class="line">        this._validateForStorage(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof obj._id == &quot;undefined&quot; &amp;&amp; !Array.isArray(obj)) &#123;</span><br><span class="line">        var tmp = obj;</span><br><span class="line">        obj = &#123;_id:new ObjectId&#125;;</span><br><span class="line">        for (var key in tmp) &#123;</span><br><span class="line">            obj[key] = tmp[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this._db._initExtraInfo();</span><br><span class="line">    this._mongo.insert(this._fullName, obj);</span><br><span class="line">    this._lastID = obj._id;</span><br><span class="line">    this._db._getExtraInfo(&quot;Inserted&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="save"><a href="#save" class="headerlink" title="save"></a>save</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.save</span><br><span class="line">function (obj) &#123;</span><br><span class="line">    if (obj == null || typeof obj == &quot;undefined&quot;) &#123;</span><br><span class="line">        throw &quot;can&#x27;t save a null&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof obj == &quot;number&quot; || typeof obj == &quot;string&quot;) &#123;</span><br><span class="line">        throw &quot;can&#x27;t save a number or string&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof obj._id == &quot;undefined&quot;) &#123;</span><br><span class="line">        obj._id = new ObjectId;</span><br><span class="line">        return this.insert(obj);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return this.update(&#123;_id:obj._id&#125;, obj, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-references/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-references/" class="post-title-link" itemprop="url">MongoDB-references</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-03 22:25:44" itemprop="dateCreated datePublished" datetime="2017-01-03T22:25:44+08:00">2017-01-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/database-references/">https://docs.mongodb.com/manual/reference/database-references/</a></p>
<p>MongoDB does not support joins. In MongoDB some data is denormalized, or stored with related data in documents to remove the need for joins. However, in some cases it makes sense to store related information in separate documents, typically in different collections or databases.</p>
<p>MongoDB applications use one of two methods for relating documents:</p>
<ul>
<li>Manual references where you save the <code>_id</code> field of one document in another document as a reference. Then your application can run a second query to return the related data. These references are simple and sufficient for most use cases.</li>
<li>DBRefs are references from one document to another using the value of the first document’s <code>_id</code> field, collection name, and, optionally, its database name. By including these names,  <strong>DBRefs allow documents located in multiple collections to be more easily linked with documents from a single collection.</strong></li>
</ul>
<p>To resolve DBRefs, your application must perform additional queries to return the referenced documents. Many drivers have helper methods that form the query for the DBRef automatically. The drivers do not automatically resolve DBRefs into documents.</p>
<p>DBRefs provide a common format and type to represent relationships among documents. The DBRef format also provides common semantics for representing links between documents if your database must interact with multiple frameworks and tools.</p>
<p>Unless you have a compelling reason to use DBRefs, use manual references instead.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/03/%E5%B7%A5%E7%A8%8B/%E6%8E%A5%E5%8F%A3/%E6%8E%A5%E5%8F%A3%E5%88%97%E8%A1%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/03/%E5%B7%A5%E7%A8%8B/%E6%8E%A5%E5%8F%A3/%E6%8E%A5%E5%8F%A3%E5%88%97%E8%A1%A8/" class="post-title-link" itemprop="url">接口列表</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-03 22:05:57" itemprop="dateCreated datePublished" datetime="2017-01-03T22:05:57+08:00">2017-01-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8E%A5%E5%8F%A3/" itemprop="url" rel="index"><span itemprop="name">接口</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="天气接口"><a href="#天气接口" class="headerlink" title="天气接口"></a>天气接口</h3><ul>
<li><code>http://wthrcdn.etouch.cn/weather_mini?citykey=101010100</code></li>
<li><code>http://wthrcdn.etouch.cn/weather_mini?city=北京</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/01/%E7%B3%BB%E7%BB%9F%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-HTTP%E7%8A%B6%E6%80%81%E7%A0%81-499/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/01/%E7%B3%BB%E7%BB%9F%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-HTTP%E7%8A%B6%E6%80%81%E7%A0%81-499/" class="post-title-link" itemprop="url">Nginx-HTTP状态码-499</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-01 08:54:17" itemprop="dateCreated datePublished" datetime="2017-01-01T08:54:17+08:00">2017-01-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://www.lc365.net/blog/b/23997/">http://www.lc365.net/blog/b/23997/</a></p>
<p>日志记录中HTTP状态码出现499错误有多种情况，我遇到的一种情况是nginx反代到一个永远打不开的后端，就这样了，日志状态记录是499、发送字节数是0。</p>
<p>499错误是什么？让我们看看NGINX的源码中的定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ngx_string(ngx_http_error_495_page), /* 495, https certificate error */</span><br><span class="line">ngx_string(ngx_http_error_496_page), /* 496, https no certificate */</span><br><span class="line">ngx_string(ngx_http_error_497_page), /* 497, http to https */</span><br><span class="line">ngx_string(ngx_http_error_404_page), /* 498, canceled */</span><br><span class="line">ngx_null_string,                    /* 499, client has closed connection */</span><br></pre></td></tr></table></figure>
<p>可以看到，499对应的是 “client has closed connection”。这很有可能是因为服务器端处理的时间过长，客户端“不耐烦”了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-$where%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/31/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/MongoDB-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-$where%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">MongoDB-常用命令-$where查询</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-31 13:57:22" itemprop="dateCreated datePublished" datetime="2016-12-31T13:57:22+08:00">2016-12-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.163.com/wm_at163/blog/static/132173490201252610424458/">http://blog.163.com/wm_at163/blog/static/132173490201252610424458/</a></p>
<p>有时候，键值对的查询方式并不能满足我们的需求，我们有如下一个集合：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.find()</span><br><span class="line">&#123; “_id” : ObjectId(“4e9165cf717ed94f8289ac0c”), “bar” : “baz”, “count” : 35 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e916661739f1da5452a4dfe”), “bar” : “bazz”, “count” : 3 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e9165cf717ed94f8289ac0d”), “bar” : “baz”, “count” : 35 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928bf8735a86e2c6f848ed”), “apple” : 1, “banana” : 6, “peach” : 3 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928c17735a86e2c6f848ee”), “apple” : 1, “spinach” : 4, “watermelon” : 4 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928d8a735a86e2c6f848ef”), “bar” : “baz”, “banana” : “baz” &#125;</span><br></pre></td></tr></table></figure>
<p>需要返回有两个字段相同的文档，也就是要返回如下文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; “_id” : ObjectId(“4e928c17735a86e2c6f848ee”), “apple” : 1, “spinach” : 4, “watermelon” : 4 &#125;</span><br><span class="line">&#123; “_id” : ObjectId(“4e928d8a735a86e2c6f848ef”), “bar” : “baz”, “banana” : “baz” &#125;</span><br></pre></td></tr></table></figure>
<p>就需要使用”$where“并借助javascript来做了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.find(&#123;“$where”:function()&#123;</span><br><span class="line">… for(var current in this)&#123;</span><br><span class="line">…   for(var other in this)&#123;</span><br><span class="line">…     if(current != other &amp;&amp; this[current] == this[other])&#123;</span><br><span class="line">…       return true;</span><br><span class="line">…     &#125;</span><br><span class="line">…   &#125;</span><br><span class="line">… &#125;</span><br><span class="line">… return false;</span><br><span class="line">… &#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>如果返回true，文档作为结果的一部分被返回；如果为false，则不会返回。</p>
<p>$where查询有以下几种写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.find(&#123;“$where”:”this.x+this.y==10″&#125;)</span><br><span class="line">&gt; db.foo.find(&#123;“$where”:”function()&#123;return this.x+this.y==10;&#125;”&#125;)</span><br></pre></td></tr></table></figure>
<p>tips：不是非常必要时，一定要避免使用”$where”查询，因为效率太低，相当的。文档在MongoDB中是以BSON格式保存的，在$where查询时，每个文档都要从BSON转换为javascript对象然后再通过”$where”中的表达式来运行。有时可以将常规查询作为前置过滤，再使用”$where”查询对结果进行调优</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/69/">69</a><a class="extend next" rel="next" href="/page/26/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhang Wetts"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Zhang Wetts</p>
  <div class="site-description" itemprop="description">Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">686</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">67</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">352</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wetts" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wetts" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhang.wetts@163.com" title="E-Mail → mailto:zhang.wetts@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Wetts</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0}});</script></body>
</html>
