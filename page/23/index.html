<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wetts.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Stay Hungry, Stay Foolish. [build by hexo&#x2F;next&#x2F;gitalk&#x2F;hexo-generator-search&#x2F;LaTeX]">
<meta property="og:type" content="website">
<meta property="og:title" content="Wetts&#39;s blog">
<meta property="og:url" content="https://wetts.github.io/page/23/index.html">
<meta property="og:site_name" content="Wetts&#39;s blog">
<meta property="og:description" content="Stay Hungry, Stay Foolish. [build by hexo&#x2F;next&#x2F;gitalk&#x2F;hexo-generator-search&#x2F;LaTeX]">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zhang Wetts">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wetts.github.io/page/23/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Wetts's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Wetts's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/wetts" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/14/%E5%B7%A5%E5%85%B7/git/github%E8%A2%AB%E5%A2%99%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/14/%E5%B7%A5%E5%85%B7/git/github%E8%A2%AB%E5%A2%99%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/" class="post-title-link" itemprop="url">github被墙设置代理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-14 13:27:41" itemprop="dateCreated datePublished" datetime="2017-01-14T13:27:41+08:00">2017-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>git config --global http.proxy &quot;localhost:8787&quot;</code></p>
<p>端口可以设置为Lantern的代理端口</p>
<p>所以需要默认不设置代理：</p>
<p><code>git config --global --unset http.proxy</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/14/%E7%B3%BB%E7%BB%9F&%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-%E9%85%8D%E7%BD%AE-%E9%99%90%E5%88%B6IP%E8%AE%BF%E9%97%AE%E7%9A%84%E5%90%84%E7%A7%8D%E6%83%85%E5%86%B5%E5%85%A8%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/14/%E7%B3%BB%E7%BB%9F&%E6%9C%8D%E5%8A%A1%E5%99%A8/Nginx/Nginx-%E9%85%8D%E7%BD%AE-%E9%99%90%E5%88%B6IP%E8%AE%BF%E9%97%AE%E7%9A%84%E5%90%84%E7%A7%8D%E6%83%85%E5%86%B5%E5%85%A8%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">Nginx-配置-限制IP访问的各种情况全解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-14 12:37:22" itemprop="dateCreated datePublished" datetime="2017-01-14T12:37:22+08:00">2017-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://www.jb51.net/article/71148.htm">http://www.jb51.net/article/71148.htm</a></p>
<h2 id="限制某个IP同一时间段的访问次数"><a href="#限制某个IP同一时间段的访问次数" class="headerlink" title="限制某个IP同一时间段的访问次数"></a>限制某个IP同一时间段的访问次数</h2><p>如何设置能限制某个IP某一时间段的访问次数是一个让人头疼的问题，特别面对恶意的ddos攻击的时候。其中CC攻击（Challenge Collapsar）是DDOS（分布式拒绝服务）的一种，也是一种常见的网站攻击方法，攻击者通过代理服务器或者肉鸡向向受害主机不停地发大量数据包， 造成对方服务器资源耗尽，一直到宕机崩溃。</p>
<p>cc攻击一般就是使用有限的ip数对服务器频繁发送数据来达到攻击的目的，nginx可以通过HttpLimitReqModul和HttpLimitZoneModule配置来限制ip在同一时间段的访问次数来防cc攻击。</p>
<p>HttpLimitReqModul用来限制连单位时间内连接数的模块，使用limit_req_zone和limit_req指令配合使用来达到限制。一旦并发连接超过指定数量，就会返回503错误。</p>
<p>HttpLimitConnModul用来限制单个ip的并发连接数，使用limit_zone和limit_conn指令</p>
<p>这两个模块的区别前一个是对一段时间内的连接数限制，后者是对同一时刻的连接数限制</p>
<h3 id="HttpLimitReqModul-限制某一段时间内同一ip访问数实例"><a href="#HttpLimitReqModul-限制某一段时间内同一ip访问数实例" class="headerlink" title="HttpLimitReqModul 限制某一段时间内同一ip访问数实例"></a>HttpLimitReqModul 限制某一段时间内同一ip访问数实例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">  ...</span><br><span class="line">  #定义一个名为allips的limit_req_zone用来存储session，大小是10M内存，</span><br><span class="line">  #以$binary_remote_addr 为key,限制平均每秒的请求为20个，</span><br><span class="line">  #1M能存储16000个状态，rete的值必须为整数，</span><br><span class="line">  #如果限制两秒钟一个请求，可以设置成30r/m</span><br><span class="line">  limit_req_zone $binary_remote_addr zone=allips:10m rate=20r/s;</span><br><span class="line">  ...</span><br><span class="line">  server&#123;</span><br><span class="line">    ...</span><br><span class="line">    location &#123;</span><br><span class="line">      ...</span><br><span class="line">      #限制每ip每秒不超过20个请求，漏桶数burst为5</span><br><span class="line">      #brust的意思就是，如果第1秒、2,3,4秒请求为19个，</span><br><span class="line">      #第5秒的请求为25个是被允许的。</span><br><span class="line">      #但是如果你第1秒就25个请求，第2秒超过20的请求返回503错误。</span><br><span class="line">      #nodelay，如果不设置该选项，严格使用平均速率限制请求数，</span><br><span class="line">      #第1秒25个请求时，5个请求放到第2秒执行，</span><br><span class="line">      #设置nodelay，25个请求将在第1秒执行。</span><br><span class="line">      limit_req zone=allips burst=5 nodelay;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HttpLimitZoneModule-限制并发连接数实例"><a href="#HttpLimitZoneModule-限制并发连接数实例" class="headerlink" title="HttpLimitZoneModule 限制并发连接数实例"></a>HttpLimitZoneModule 限制并发连接数实例</h3><p>limit_zone只能定义在http作用域，limit_conn可以定义在http server location作用域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">  ...</span><br><span class="line">  #定义一个名为one的limit_zone,大小10M内存来存储session，</span><br><span class="line">  #以$binary_remote_addr 为key</span><br><span class="line">  #nginx 1.18以后用limit_conn_zone替换了limit_conn</span><br><span class="line">  #且只能放在http作用域</span><br><span class="line">  limit_conn_zone  one $binary_remote_addr 10m;</span><br><span class="line">  ...</span><br><span class="line">  server&#123;</span><br><span class="line">    ...</span><br><span class="line">    location &#123;</span><br><span class="line">      ...</span><br><span class="line">      limit_conn one 20;     #连接数限制</span><br><span class="line">      #带宽限制,对单个连接限数，如果一个ip两个连接，就是500x2k</span><br><span class="line">      limit_rate 500k;     </span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="服务器全局限IP"><a href="#服务器全局限IP" class="headerlink" title="服务器全局限IP"></a>服务器全局限IP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#vi nginx.conf</span><br><span class="line">  allow 10.57.22.172;</span><br><span class="line">  deny all;</span><br></pre></td></tr></table></figure>

<h2 id="指定目录的IP访问限制"><a href="#指定目录的IP访问限制" class="headerlink" title="指定目录的IP访问限制"></a>指定目录的IP访问限制</h2><p>实现重点</p>
<p>正则表达式中()和|的使用，（）代表一个原则，|代表或</p>
<p>nginx的location匹配规则中，有一条按照文件顺序进行正则匹配(ps:可以把需要匹配的目录放置在server模块开始的位置)</p>
<p>allow和deny的使用</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>目录结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">根目录/srv/</span><br><span class="line">test1 / --  hello.php</span><br><span class="line">test2/  --  hello.php</span><br><span class="line">test3/  --  hello.php</span><br><span class="line">test4/  --  &#123;hello.php,1.php,2.php&#125;</span><br></pre></td></tr></table></figure>

<h3 id="访问需求"><a href="#访问需求" class="headerlink" title="访问需求"></a>访问需求</h3><p>对于test1,test2目录，只允许指定的192.168.1.101ip地址访问，禁止其它ip访问</p>
<p>对于其他目录的php程序，所有ip地址均可以访问</p>
<p>实现的nginx配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#指定目录实行白名单访问机制</span><br><span class="line">location ~ ^/(test1|test2)/ &#123;</span><br><span class="line">  allow 192.168.1.101;</span><br><span class="line">  deny all;</span><br><span class="line"></span><br><span class="line">  root /srv/;  </span><br><span class="line">  fastcgi_param  HTTPS  on;</span><br><span class="line">    include /etc/nginx/fastcgi_params;  </span><br><span class="line">    fastcgi_pass  php5_fpm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># proxy the PHP scripts to fpm</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">root /srv/;  </span><br><span class="line">fastcgi_param  HTTPS  on;</span><br><span class="line">  include /etc/nginx/fastcgi_params;  </span><br><span class="line">  fastcgi_pass  php5_fpm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项:"></a>注意事项:</h3><ol>
<li>deny 一定要加一个ip，否则直接跳转到403,不往下执行了;如果403默认页是同一域名下，会造成死循环访问；</li>
<li>allow的ip段</li>
</ol>
<p>  从允许访问的段位从小到大排列,如127.0.0.0/24</p>
<p>  下面才能是10.10.0.0/16</p>
<p>  24表示子网掩码:255.255.255.0</p>
<p>  16表示子网掩码:255.255.0.0</p>
<p>  8表示子网掩码:255.0.0.0</p>
<ol start="3">
<li>deny all;结尾 表示除了上面allow的其他都禁止</li>
</ol>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deny 192.168.1.1;           allow 127.0.0.0/24;           allo w 192.168.0.0/16;           allow 10.10.0.0/16;           deny all;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-dict%E3%80%81ziplist%E3%80%81skiplist/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-dict%E3%80%81ziplist%E3%80%81skiplist/" class="post-title-link" itemprop="url">Redis-数据结构-dict、ziplist、skiplist</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-13 16:29:37" itemprop="dateCreated datePublished" datetime="2017-01-13T16:29:37+08:00">2017-01-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://redisbook.readthedocs.io/en/latest/datatype/sorted_set.html">http://redisbook.readthedocs.io/en/latest/datatype/sorted_set.html</a></p>
<h2 id="字典："><a href="#字典：" class="headerlink" title="字典："></a>字典：</h2><p>非常常见的数据结构，key-value结构。</p>
<p>常见的实现有红黑树（stl中的map），哈希表（stl中的unordered_map）。红黑树的查找操作具有O（logN）的时间复杂度。哈希表的查找操作具有O(1)的时间复杂度。 redis中的字典使用哈希表作为底层实现。</p>
<h2 id="压缩列表："><a href="#压缩列表：" class="headerlink" title="压缩列表："></a>压缩列表：</h2><p>由一些列特殊编码的连续内存块组成的顺序型数据结构。</p>
<p>压缩列表可以包含多种节点（只能保存一种的那叫数组）。压缩列表的优点是节省内存。顺序结构拥有的缺点压缩列表全都有。</p>
<h2 id="跳跃表："><a href="#跳跃表：" class="headerlink" title="跳跃表："></a>跳跃表：</h2><p>一种有序数据结构，它通过在每个节点中维护多个指向其他节点的指针，从而达到快速访问节点的目的。</p>
<p>跳跃表支持平均O（logN）、最坏O（N）时间复杂度的节点查找。</p>
<p>redis中的跳跃表由zskiplist和zskiplistNode两个结构组成，其中zskiplist用于保存跳跃表的信息（比如表头节点、表尾节点、长度），而zskiplistNode用于表示跳跃表节点。跳跃表中的节点按照分支大小进行排序，当分值相同时，节点按照成员对象的大小进行排序。在同一跳跃表中，多个节点可以包含相同的分值，但每节点的成员对象必须是唯一的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/" class="post-title-link" itemprop="url">Redis-数据结构-zset</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-13 16:05:13" itemprop="dateCreated datePublished" datetime="2017-01-13T16:05:13+08:00">2017-01-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://redisbook.readthedocs.io/en/latest/datatype/sorted_set.html">http://redisbook.readthedocs.io/en/latest/datatype/sorted_set.html</a></p>
<h2 id="有序集"><a href="#有序集" class="headerlink" title="有序集"></a>有序集</h2><p>REDIS_ZSET （有序集）是 ZADD 、 ZCOUNT 等命令的操作对象， 它使用 REDIS_ENCODING_ZIPLIST 和 REDIS_ENCODING_SKIPLIST 两种方式编码：</p>
<p><img src="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/zset.png" alt="zset"></p>
<h2 id="编码的选择"><a href="#编码的选择" class="headerlink" title="编码的选择"></a>编码的选择</h2><p>在通过 ZADD 命令添加第一个元素到空 key 时， 程序通过检查输入的第一个元素来决定该创建什么编码的有序集。</p>
<p>如果第一个元素符合以下条件的话， 就创建一个 REDIS_ENCODING_ZIPLIST 编码的有序集：</p>
<ul>
<li>服务器属性 server.zset_max_ziplist_entries 的值大于 0 （默认为 128 ）。</li>
<li>元素的 member 长度小于服务器属性 server.zset_max_ziplist_value 的值（默认为 64 ）。</li>
</ul>
<p>否则，程序就创建一个 REDIS_ENCODING_SKIPLIST 编码的有序集。</p>
<h2 id="编码的转换"><a href="#编码的转换" class="headerlink" title="编码的转换"></a>编码的转换</h2><p>对于一个 REDIS_ENCODING_ZIPLIST 编码的有序集， 只要满足以下任一条件， 就将它转换为 REDIS_ENCODING_SKIPLIST 编码：</p>
<ul>
<li>ziplist 所保存的元素数量超过服务器属性 server.zset_max_ziplist_entries 的值（默认值为 128 ）</li>
<li>新添加元素的 member 的长度大于服务器属性 server.zset_max_ziplist_value 的值（默认值为 64 ）</li>
</ul>
<h2 id="ZIPLIST-编码的有序集"><a href="#ZIPLIST-编码的有序集" class="headerlink" title="ZIPLIST 编码的有序集"></a>ZIPLIST 编码的有序集</h2><p>当使用 REDIS_ENCODING_ZIPLIST 编码时， 有序集将元素保存到 ziplist 数据结构里面。</p>
<p>其中，每个有序集元素以两个相邻的 ziplist 节点表示， 第一个节点保存元素的 member 域， 第二个元素保存元素的 score 域。</p>
<p><strong>多个元素之间按 score 值从小到大排序， 如果两个元素的 score 相同， 那么按字典序对 member 进行对比， 决定哪个元素排在前面， 哪个元素排在后面。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">          |&lt;--  element 1 --&gt;|&lt;--  element 2 --&gt;|&lt;--   .......   --&gt;|</span><br><span class="line"></span><br><span class="line">+---------+---------+--------+---------+--------+---------+---------+---------+</span><br><span class="line">| ZIPLIST |         |        |         |        |         |         | ZIPLIST |</span><br><span class="line">| ENTRY   | member1 | score1 | member2 | score2 |   ...   |   ...   | ENTRY   |</span><br><span class="line">| HEAD    |         |        |         |        |         |         | END     |</span><br><span class="line">+---------+---------+--------+---------+--------+---------+---------+---------+</span><br><span class="line"></span><br><span class="line">score1 &lt;= score2 &lt;= ...</span><br></pre></td></tr></table></figure>
<p>虽然元素是按 score 域有序排序的， 但对 ziplist 的节点指针只能线性地移动， 所以在 REDIS_ENCODING_ZIPLIST 编码的有序集中， 查找某个给定元素的复杂度为 O(N) 。</p>
<p>每次执行添加/删除/更新操作都需要执行一次查找元素的操作， 因此这些函数的复杂度都不低于 O(N) ， 至于这些操作的实际复杂度， 取决于它们底层所执行的 ziplist 操作。</p>
<h2 id="SKIPLIST-编码的有序集"><a href="#SKIPLIST-编码的有序集" class="headerlink" title="SKIPLIST 编码的有序集"></a>SKIPLIST 编码的有序集</h2><p>当使用 REDIS_ENCODING_SKIPLIST 编码时， 有序集元素由 redis.h/zset 结构来保存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 有序集</span><br><span class="line"> */</span><br><span class="line">typedef struct zset &#123;</span><br><span class="line"></span><br><span class="line">    // 字典</span><br><span class="line">    dict *dict;</span><br><span class="line"></span><br><span class="line">    // 跳跃表</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line"></span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure>
<p>zset 同时使用字典和跳跃表两个数据结构来保存有序集元素。</p>
<p>其中， 元素的成员由一个 redisObject 结构表示， 而元素的 score 则是一个 double 类型的浮点数， 字典和跳跃表两个结构通过将指针共同指向这两个值来节约空间 （不用每个元素都复制两份）。</p>
<p>下图展示了一个 REDIS_ENCODING_SKIPLIST 编码的有序集：</p>
<p><img src="/2017/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-zset/skiplist.png" alt="skiplist"></p>
<p>通过使用字典结构， 并将 member 作为键， score 作为值， 有序集可以在 O(1) 时间复杂度内：</p>
<ul>
<li>检查给定 member 是否存在于有序集（被很多底层函数使用）；</li>
<li>取出 member 对应的 score 值（实现 ZSCORE 命令）。</li>
</ul>
<p>另一方面， 通过使用跳跃表， 可以让有序集支持以下两种操作：</p>
<ul>
<li>在 O(logN) 期望时间、 O(N) 最坏时间内根据 score 对 member 进行定位（被很多底层函数使用）；</li>
<li>范围性查找和处理操作，这是（高效地）实现 ZRANGE 、 ZRANK 和 ZINTERSTORE 等命令的关键。</li>
</ul>
<p>通过同时使用字典和跳跃表， 有序集可以高效地实现按成员查找和按顺序查找两种操作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/12/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/12/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis/Redis-%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Redis-保护模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-12 11:54:47" itemprop="dateCreated datePublished" datetime="2017-01-12T11:54:47+08:00">2017-01-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：<a target="_blank" rel="noopener" href="https://redis.io/topics/security">https://redis.io/topics/security</a></p>
<p><strong>Protected mode</strong></p>
<p>Unfortunately many users fail to protect Redis instances from being accessed from external networks. Many instances are simply left exposed on the internet with public IPs. For this reasons since version 3.2.0, when Redis is executed with the default configuration (binding all the interfaces) and without any password in order to access it, it enters a special mode called protected mode. In this mode Redis only replies to queries from the loopback interfaces, and reply to other clients connecting from other addresses with an error, explaining what is happening and how to configure Redis properly.</p>
<p>We expect protected mode to seriously decrease the security issues caused by unprotected Redis instances executed without proper administration, however the system administrator can still ignore the error given by Redis and just disable protected mode or manually bind all the interfaces.</p>
<hr>
<p>Redis从3.2开始加强安全管理，如果redis没有设置密码，那么redis客户端只能从本地进行访问，如果是从其他机器连接过来访问的，就会报错误。</p>
<p>保护模式下，可以查看参数<code>protected-mode</code>值为yes</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><ol>
<li>为Redis设置密码</li>
<li>将<code>protected-mode</code>值设置为为no<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config set protected-mode no</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-11.%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8%E5%BC%BA%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-11.%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8%E5%BC%BA%E5%BA%A6/" class="post-title-link" itemprop="url">Java虚拟机学习-11.对象引用强度</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-08 14:09:01" itemprop="dateCreated datePublished" datetime="2017-01-08T14:09:01+08:00">2017-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8090276">http://blog.csdn.net/java2000_wl/article/details/8090276</a></p>
<p>无论是通过计数算法判断对象的引用数量，还是通过根搜索算法判断对象引用链是否可达，判定对象是否存活都与“引用”相关。</p>
<p>引用主要分为 ：强引用(Strong Reference)、软引用(Soft Reference)、弱引用(Weak Reference)、虚引用(PhantomReference) 四种，引用的强度依次骤减。</p>
<h2 id="强引用："><a href="#强引用：" class="headerlink" title="强引用："></a>强引用：</h2><p>就是指在代码之中普遍存在的，类似：“Object objectRef = new Obejct”，这种引用，只要强引用还存在，永远不会被GC清理。</p>
<h2 id="软引用："><a href="#软引用：" class="headerlink" title="软引用："></a>软引用：</h2><p>用来描述一些还有用，但并非必须存在的对象，当Jvm内存不足时（内存溢出之前）会被回收，如果执行GC后，还是没有足够的空间，才会抛出内存溢出异常。</p>
<p>通过SoftReference类来实现软引用，SoftReference很适合用于实现缓存。另，当GC认为扫描的SoftReference不经常使用时，可会进行回收。</p>
<p>使用方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User user = new User();  </span><br><span class="line">SoftReference&lt;Object&gt; softReference  = new SoftReference&lt;Object&gt;(user);  </span><br><span class="line">softReference.get();  </span><br></pre></td></tr></table></figure>

<h2 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h2><p>弱引用也是用来描述一些还有用，但并非必须存在的对象，它的强度会比软引用弱些，被弱引用关联的对象，只能生存到下一次GC前，当GC工作时，无论内存是否足够，都会回收掉弱引用关联的对象。JDK通过WeakReference类来实现。</p>
<p>当获取时，可通过weakReference.get方法获取，可能返回null</p>
<p>可传入一个ReferenceQueue对象到WeakReference构造，当引用对象被表示为可回收时，isEnqueued返回true</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User user = new User();  </span><br><span class="line">WeakReference&lt;User&gt; weakReference = new WeakReference&lt;User&gt;(user);  </span><br><span class="line">weakReference.get();  </span><br><span class="line"></span><br><span class="line">ReferenceQueue&lt;User&gt; referenceQueue = new ReferenceQueue&lt;User&gt;();  </span><br><span class="line">WeakReference&lt;User&gt; weakReference2 = new WeakReference&lt;User&gt;(user, referenceQueue);  </span><br><span class="line">//当引用对象被标识为可回收时  返回true,  即当user对象标识为可回收时，返回true  </span><br><span class="line">weakReference.isEnqueued();  </span><br></pre></td></tr></table></figure>

<h1 id="虚引用"><a href="#虚引用" class="headerlink" title="虚引用"></a>虚引用</h1><p>虚引用称为“幻影引用”，它是最弱的一种引用关系，一个对象是否有虚引用的存在，完全不会对生存时间构成影响。为一个对象设置虚引用关联的唯一目的就是希望能在这个对象被GC回收时收到一个系统通知。通过PhantomReference类实现。<br>值得注意的是：phantomReference.get方法永远返回null, 当user从内存中删除时，调用isEnqueued会返回true</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User user = new User();  </span><br><span class="line">ReferenceQueue&lt;User&gt; referenceQueue = new ReferenceQueue&lt;User&gt;();  </span><br><span class="line">PhantomReference&lt;User&gt;  phantomReference = new PhantomReference&lt;User&gt;(user, referenceQueue);  </span><br><span class="line">//即当user对象标识为可回收时，返回true  </span><br><span class="line">System.out.println(phantomReference.isEnqueued());  </span><br><span class="line">//永远返回null  </span><br><span class="line">System.out.println(phantomReference.get());  </span><br></pre></td></tr></table></figure>
<p>其他相关类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WeakCache weakCache  = new WeakCache();  </span><br><span class="line">SoftCache softCache = new SoftCache();  </span><br><span class="line">WeakHashMap weakHashMap  = new WeakHashMap();  </span><br></pre></td></tr></table></figure>
<p>当垃圾回收机制运行，扫描引用关系，GC会对这三种类型的引用进行不同的处理，简单来说，GC首先会判断所扫描到的引用是否为Reference类型，如果为Reference类型，且其所引用的对象无强引用，则认为该对象为相应的Reference类型，之后GC在垃圾回收时这些对象则根据Reference类型的不同进行相应处理。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-10.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-10.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/" class="post-title-link" itemprop="url">Java虚拟机学习-10.垃圾收集器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-08 13:51:25" itemprop="dateCreated datePublished" datetime="2017-01-08T13:51:25+08:00">2017-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8222876">http://blog.csdn.net/java2000_wl/article/details/8222876</a></p>
<h2 id="HotSpot-JVM收集器"><a href="#HotSpot-JVM收集器" class="headerlink" title="HotSpot JVM收集器"></a>HotSpot JVM收集器</h2><p><img src="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-10.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="垃圾收集器"></p>
<p>上面有7中收集器，分为两块，上面为新生代收集器，下面是老年代收集器。如果两个收集器之间存在连线，就说明它们可以搭配使用。</p>
<h3 id="Serial-串行GC-收集器"><a href="#Serial-串行GC-收集器" class="headerlink" title="Serial(串行GC)收集器"></a>Serial(串行GC)收集器</h3><p>Serial收集器是一个新生代收集器，单线程执行，使用复制算法。它在进行垃圾收集时，必须暂停其他所有的工作线程(用户线程)。是Jvm client模式下默认的新生代收集器。对于限定单个CPU的环境来说，Serial收集器由于没有线程交互的开销，专心做垃圾收集自然可以获得最高的单线程收集效率。</p>
<h3 id="ParNew-并行GC-收集器"><a href="#ParNew-并行GC-收集器" class="headerlink" title="ParNew(并行GC)收集器"></a>ParNew(并行GC)收集器</h3><p>ParNew收集器其实就是serial收集器的多线程版本，除了使用多条线程进行垃圾收集之外，其余行为与Serial收集器一样。</p>
<h3 id="Parallel-Scavenge-并行回收GC-收集器"><a href="#Parallel-Scavenge-并行回收GC-收集器" class="headerlink" title="Parallel Scavenge(并行回收GC)收集器"></a>Parallel Scavenge(并行回收GC)收集器</h3><p>Parallel Scavenge收集器也是一个新生代收集器，它也是使用复制算法的收集器，又是并行多线程收集器。parallel Scavenge收集器的特点是它的关注点与其他收集器不同，CMS等收集器的关注点是尽可能地缩短垃圾收集时用户线程的停顿时间，而parallel Scavenge收集器的目标则是达到一个可控制的吞吐量。吞吐量= 程序运行时间/(程序运行时间 + 垃圾收集时间)，虚拟机总共运行了100分钟。其中垃圾收集花掉1分钟，那吞吐量就是99%。</p>
<h3 id="Serial-Old-串行GC-收集器"><a href="#Serial-Old-串行GC-收集器" class="headerlink" title="Serial Old(串行GC)收集器"></a>Serial Old(串行GC)收集器</h3><p>Serial Old是Serial收集器的老年代版本，它同样使用一个单线程执行收集，使用“标记-整理”算法。主要使用在Client模式下的虚拟机。</p>
<h3 id="Parallel-Old-并行GC-收集器"><a href="#Parallel-Old-并行GC-收集器" class="headerlink" title="Parallel Old(并行GC)收集器"></a>Parallel Old(并行GC)收集器</h3><p>Parallel Old是Parallel Scavenge收集器的老年代版本，使用多线程和“标记-整理”算法。</p>
<h3 id="CMS-并发GC-收集器"><a href="#CMS-并发GC-收集器" class="headerlink" title="CMS(并发GC)收集器"></a>CMS(并发GC)收集器</h3><p>CMS(Concurrent Mark Sweep)收集器是一种以获取最短回收停顿时间为目标的收集器。CMS收集器是基于“标记-清除”算法实现的，整个收集过程大致分为4个步骤：</p>
<ol>
<li>初始标记(CMS initial mark)</li>
<li>并发标记(CMS concurrenr mark)</li>
<li>重新标记(CMS remark)</li>
<li>并发清除(CMS concurrent sweep)</li>
</ol>
<p>其中初始标记、重新标记这两个步骤任然需要停顿其他用户线程。初始标记仅仅只是标记出GC ROOTS能直接关联到的对象，速度很快，并发标记阶段是进行GC ROOTS 根搜索算法阶段，会判定对象是否存活。而重新标记阶段则是为了修正并发标记期间，因用户程序继续运行而导致标记产生变动的那一部分对象的标记记录，这个阶段的停顿时间会被初始标记阶段稍长，但比并发标记阶段要短。</p>
<p>由于整个过程中耗时最长的并发标记和并发清除过程中，收集器线程都可以与用户线程一起工作，所以整体来说，CMS收集器的内存回收过程是与用户线程一起并发执行的。</p>
<p>CMS收集器的优点：并发收集、低停顿，但是CMS还远远达不到完美，器主要有三个显著缺点：</p>
<p>CMS收集器对CPU资源非常敏感。在并发阶段，虽然不会导致用户线程停顿，但是会占用CPU资源而导致引用程序变慢，总吞吐量下降。CMS默认启动的回收线程数是：(CPU数量+3) / 4。</p>
<p>CMS收集器无法处理浮动垃圾，可能出现“Concurrent Mode Failure“，失败后而导致另一次Full  GC的产生。由于CMS并发清理阶段用户线程还在运行，伴随程序的运行自热会有新的垃圾不断产生，这一部分垃圾出现在标记过程之后，CMS无法在本次收集中处理它们，只好留待下一次GC时将其清理掉。这一部分垃圾称为“浮动垃圾”。也是由于在垃圾收集阶段用户线程还需要运行，</p>
<p>即需要预留足够的内存空间给用户线程使用，因此CMS收集器不能像其他收集器那样等到老年代几乎完全被填满了再进行收集，需要预留一部分内存空间提供并发收集时的程序运作使用。在默认设置下，CMS收集器在老年代使用了68%的空间时就会被激活，也可以通过参数-XX:CMSInitiatingOccupancyFraction的值来提供触发百分比，以降低内存回收次数提高性能。要是CMS运行期间预留的内存无法满足程序其他线程需要，就会出现“Concurrent Mode Failure”失败，这时候虚拟机将启动后备预案：临时启用Serial Old收集器来重新进行老年代的垃圾收集，这样停顿时间就很长了。所以说参数-XX:CMSInitiatingOccupancyFraction设置的过高将会很容易导致“Concurrent Mode Failure”失败，性能反而降低。</p>
<p>最后一个缺点，CMS是基于“标记-清除”算法实现的收集器，使用“标记-清除”算法收集后，会产生大量碎片。空间碎片太多时，将会给对象分配带来很多麻烦，比如说大对象，内存空间找不到连续的空间来分配不得不提前触发一次Full  GC。为了解决这个问题，CMS收集器提供了一个-XX:UseCMSCompactAtFullCollection开关参数，用于在Full  GC之后增加一个碎片整理过程，还可通过-XX:CMSFullGCBeforeCompaction参数设置执行多少次不压缩的Full  GC之后，跟着来一次碎片整理过程。</p>
<h3 id="G1收集器"><a href="#G1收集器" class="headerlink" title="G1收集器"></a>G1收集器</h3><p>G1(Garbage First)收集器是JDK1.7提供的一个新收集器，G1收集器基于“标记-整理”算法实现，也就是说不会产生内存碎片。还有一个特点之前的收集器进行收集的范围都是整个新生代或老年代，而G1将整个Java堆(包括新生代，老年代)。</p>
<h2 id="垃圾收集器参数总结"><a href="#垃圾收集器参数总结" class="headerlink" title="垃圾收集器参数总结"></a>垃圾收集器参数总结</h2><ul>
<li>-XX:+<option> 启用选项</option></li>
<li>-XX:-<option> 不启用选项</option></li>
<li>-XX:<option>=<number></number></option></li>
<li>-XX:<option>=<string></string></option></li>
</ul>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-XX:+UseSerialGC</td>
<td align="center">Jvm运行在Client模式下的默认值，打开此开关后，使用Serial + Serial Old的收集器组合进行内存回收</td>
</tr>
<tr>
<td align="center">-XX:+UseParNewGC</td>
<td align="center">打开此开关后，使用ParNew + Serial Old的收集器进行垃圾回收</td>
</tr>
<tr>
<td align="center">-XX:+UseConcMarkSweepGC</td>
<td align="center">使用ParNew + CMS +  Serial Old的收集器组合进行内存回收，Serial Old作为CMS出现“Concurrent Mode Failure”失败后的后备收集器使用。</td>
</tr>
<tr>
<td align="center">-XX:+UseParallelGC</td>
<td align="center">Jvm运行在Server模式下的默认值，打开此开关后，使用Parallel Scavenge +  Serial Old的收集器组合进行回收</td>
</tr>
<tr>
<td align="center">-XX:+UseParallelOldGC</td>
<td align="center">使用Parallel Scavenge +  Parallel Old的收集器组合进行回收</td>
</tr>
<tr>
<td align="center">-XX:SurvivorRatio</td>
<td align="center">新生代中Eden区域与Survivor区域的容量比值，默认为8，代表Eden:Subrvivor = 8:1</td>
</tr>
<tr>
<td align="center">-XX:PretenureSizeThreshold</td>
<td align="center">直接晋升到老年代对象的大小，设置这个参数后，大于这个参数的对象将直接在老年代分配</td>
</tr>
<tr>
<td align="center">-XX:MaxTenuringThreshold</td>
<td align="center">晋升到老年代的对象年龄，每次Minor GC之后，年龄就加1，当超过这个参数的值时进入老年代</td>
</tr>
<tr>
<td align="center">-XX:UseAdaptiveSizePolicy</td>
<td align="center">动态调整java堆中各个区域的大小以及进入老年代的年龄</td>
</tr>
<tr>
<td align="center">-XX:+HandlePromotionFailure</td>
<td align="center">是否允许新生代收集担保，进行一次minor gc后, 另一块Survivor空间不足时，将直接会在老年代中保留</td>
</tr>
<tr>
<td align="center">-XX:ParallelGCThreads</td>
<td align="center">设置并行GC进行内存回收的线程数</td>
</tr>
<tr>
<td align="center">-XX:GCTimeRatio</td>
<td align="center">GC时间占总时间的比列，默认值为99，即允许1%的GC时间，仅在使用Parallel Scavenge 收集器时有效</td>
</tr>
<tr>
<td align="center">-XX:MaxGCPauseMillis</td>
<td align="center">设置GC的最大停顿时间，在Parallel Scavenge 收集器下有效</td>
</tr>
<tr>
<td align="center">-XX:CMSInitiatingOccupancyFraction</td>
<td align="center">设置CMS收集器在老年代空间被使用多少后出发垃圾收集，默认值为68%，仅在CMS收集器时有效，-XX:CMSInitiatingOccupancyFraction=70</td>
</tr>
<tr>
<td align="center">-XX:+UseCMSCompactAtFullCollection</td>
<td align="center">由于CMS收集器会产生碎片，此参数设置在垃圾收集器后是否需要一次内存碎片整理过程，仅在CMS收集器时有效</td>
</tr>
<tr>
<td align="center">-XX:+CMSFullGCBeforeCompaction</td>
<td align="center">设置CMS收集器在进行若干次垃圾收集后再进行一次内存碎片整理过程，通常与UseCMSCompactAtFullCollection参数一起使用</td>
</tr>
<tr>
<td align="center">-XX:+UseFastAccessorMethods</td>
<td align="center">原始类型优化</td>
</tr>
<tr>
<td align="center">-XX:+DisableExplicitGC</td>
<td align="center">是否关闭手动System.gc</td>
</tr>
<tr>
<td align="center">-XX:+CMSParallelRemarkEnabled</td>
<td align="center">降低标记停顿</td>
</tr>
<tr>
<td align="center">-XX:LargePageSizeInBytes</td>
<td align="center">内存页的大小不可设置过大，会影响Perm的大小，-XX:LargePageSizeInBytes=128m</td>
</tr>
</tbody></table>
<h3 id="Client、Server模式默认GC"><a href="#Client、Server模式默认GC" class="headerlink" title="Client、Server模式默认GC"></a>Client、Server模式默认GC</h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">新生代GC方式</th>
<th align="center">老年代和持久代GC方式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Client</td>
<td align="center">Serial 串行GC</td>
<td align="center">Serial Old 串行GC</td>
</tr>
<tr>
<td align="center">Server</td>
<td align="center">Parallel Scavenge  并行回收GC</td>
<td align="center">Parallel Old 并行GC</td>
</tr>
</tbody></table>
<h3 id="Sun-oracle-JDK-GC组合方式"><a href="#Sun-oracle-JDK-GC组合方式" class="headerlink" title="Sun/oracle JDK GC组合方式"></a>Sun/oracle JDK GC组合方式</h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">新生代GC方式</th>
<th align="center">老年代和持久代GC方式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-XX:+UseSerialGC</td>
<td align="center">Serial 串行GC</td>
<td align="center">Serial Old 串行GC</td>
</tr>
<tr>
<td align="center">-XX:+UseParallelGC</td>
<td align="center">Parallel Scavenge  并行回收GC</td>
<td align="center">Serial Old  并行GC</td>
</tr>
<tr>
<td align="center">-XX:+UseConcMarkSweepGC</td>
<td align="center">ParNew 并行GC</td>
<td align="center">CMS 并发GC。当出现“Concurrent Mode Failure”时，采用Serial Old 串行GC</td>
</tr>
<tr>
<td align="center">-XX:+UseParNewGC</td>
<td align="center">ParNew 并行GC</td>
<td align="center">Serial Old 串行GC</td>
</tr>
<tr>
<td align="center">-XX:+UseParallelOldGC</td>
<td align="center">Parallel Scavenge  并行回收GC</td>
<td align="center">Parallel Old 并行GC</td>
</tr>
<tr>
<td align="center">-XX:+UseConcMarkSweepGC -XX:+UseParNewGC</td>
<td align="center">Serial 串行GC</td>
<td align="center">CMS 并发GC。当出现“Concurrent Mode Failure”时，采用Serial Old 串行GC</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-9.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%88ClassLoader%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-9.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%88ClassLoader%EF%BC%89/" class="post-title-link" itemprop="url">Java虚拟机学习-9.类加载器（ClassLoader）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-08 13:40:36" itemprop="dateCreated datePublished" datetime="2017-01-08T13:40:36+08:00">2017-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8222876">http://blog.csdn.net/java2000_wl/article/details/8222876</a></p>
<h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2><p>类加载器(ClassLoader)用来加载 class字节码到 Java 虚拟机中。一般来说，Java 虚拟机使用 Java 类的方式如下：Java 源文件在经过 Javac之后就被转换成 Java 字节码文件(.class 文件)。类加载器负责读取 Java 字节代码，并转换成 java.lang.Class 类的一个实例。每一个这样的实例用来表示一个 Java 类。实际的情况可能更加复杂，比如 Java 字节代码可能是通过工具动态生成的，也可能是通过网络下载。</p>
<h2 id="类与类加载器"><a href="#类与类加载器" class="headerlink" title="类与类加载器"></a>类与类加载器</h2><p>类加载器虽然只用于实现类的加载动作，但它在Java程序中起到的作用却远远不限于类加载阶段。对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟中的唯一性。说通俗一些，比较两个类是否“相等”，只有在两个类是由同一个类加载器的前提之下才有意义，否则，即使这两个类来源于同一个class文件，只要加载它的类加载器不同，那这两个类必定不相等。这里所指的“相等”包括代表类的Class对象的equal方法、isAssignableFrom()、isInstance()方法及instance关键字返回的结果。</p>
<h2 id="类加载器分类："><a href="#类加载器分类：" class="headerlink" title="类加载器分类："></a>类加载器分类：</h2><p><img src="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-9.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%88ClassLoader%EF%BC%89/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%B1%BB.png" alt="类加载器分类"></p>
<p>主要分为Bootstrap ClassLoader、Extension ClassLoader、Application ClassLoader和User Defined ClassLoader。</p>
<h3 id="启动类加载器-Bootstrap-ClassLoader-："><a href="#启动类加载器-Bootstrap-ClassLoader-：" class="headerlink" title="启动类加载器(Bootstrap ClassLoader)："></a>启动类加载器(Bootstrap ClassLoader)：</h3><p>这个类加载器使用C++语言实现，并非ClassLoader的子类。主要负责加载存放在JAVA_HOME /  jre /  lib / rt.jar里面所有的class文件，或者被-Xbootclasspath参数所指定路径中以rt.jar命名的文件。</p>
<h3 id="扩展类加载器-Extension-ClassLoader-："><a href="#扩展类加载器-Extension-ClassLoader-：" class="headerlink" title="扩展类加载器(Extension ClassLoader)："></a>扩展类加载器(Extension ClassLoader)：</h3><p>这个加载器由sun.misc.Launcher$ExtClassLoader实现，它负责加载AVA_HOME /  lib / ext目录中的，或者被java.ext.dirs系统变量所指定的路径中的所有类库。</p>
<h3 id="应用程序类加载器-Application-ClassLoader-："><a href="#应用程序类加载器-Application-ClassLoader-：" class="headerlink" title="应用程序类加载器(Application ClassLoader)："></a>应用程序类加载器(Application ClassLoader)：</h3><p>这个加载器由sun.misc.Launcher$AppClassLoader实现，它负责加载classpath对应的jar及目录。一般情况下这个就是程序中默认的类加载器。</p>
<h3 id="自定义类加载器-User-Defined-ClassLoader-："><a href="#自定义类加载器-User-Defined-ClassLoader-：" class="headerlink" title="自定义类加载器(User Defined ClassLoader)："></a>自定义类加载器(User Defined ClassLoader)：</h3><p>开发人员继承ClassLoader抽象类自行实现的类加载器，基于自行开发的ClassLoader可用于并非加载classpath中(例如从网络上下载的jar或二进制字节码)、还可以在加载class文件之前做些小动作 如：加密等。</p>
<h2 id="双亲委托模型："><a href="#双亲委托模型：" class="headerlink" title="双亲委托模型："></a>双亲委托模型：</h2><p>上图中所展示的类加载器之间的这种层次关系，就称为类加载器的双亲委托模型。双亲委托模型要求除了顶层的启动类加载器外，其余的类加载器都应当有自己的父类加载器。这里类加载器之间的父子关系一般不会以继承的关系来实现，而是使用组合关系来复用父加载器的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public abstract class ClassLoader &#123;  </span><br><span class="line"></span><br><span class="line">    private static native void registerNatives();  </span><br><span class="line">    static &#123;  </span><br><span class="line">        registerNatives();  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    // The parent class loader for delegation  </span><br><span class="line">    private ClassLoader parent;  </span><br><span class="line"></span><br><span class="line">    // Hashtable that maps packages to certs  </span><br><span class="line">    private Hashtable package2certs = new Hashtable(11);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>双亲委托的工作过程：如果一个类加载器收到了一个类加载请求，它首先不会自己去加载这个类，而是把这个请求委托给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的加载请求最终都应该传送到顶层的启动类加载器中，只有当父类加载器反馈自己无法完成加载请求(它管理的范围之中没有这个类)时，子加载器才会尝试着自己去加载。</p>
<p>使用双亲委托模型来组织类加载器之间的关系，有一个显而易见的好处就是Java类随着它的类加载器一起具备了一种带有优先级的层次关系，例如java.lang.Object存放在rt.jar之中，无论那个类加载器要加载这个类，最终都是委托给启动类加载器进行加载，因此Object类在程序的各种类加载器环境中都是同一个类，相反，如果没有双亲委托模型，由各个类加载器去完成的话，如果用户自己写一个名为java.lang.Object的类，并放在classpath中，应用程序中可能会出现多个不同的Object类，java类型体系中最基本安全行为也就无法保证。</p>
<h2 id="类加载器SPI："><a href="#类加载器SPI：" class="headerlink" title="类加载器SPI："></a>类加载器SPI：</h2><p>java.lang.ClassLoader 类提供的几个关键方法：<br>loadClass： 此方法负责加载指定名字的类，首先会从已加载的类中去寻找，如果没有找到；从parent ClassLoader[ExtClassLoader]中加载；如果没有加载到，则从Bootstrap ClassLoader中尝试加载(findBootstrapClassOrNull方法), 如果还是加载失败，则抛出异常ClassNotFoundException, 在调用自己的findClass方法进行加载。如果要改变类的加载顺序可以覆盖此方法；如果加载顺序相同，则可以通过覆盖findClass方法来做特殊处理，例如：解密，固定路径寻找等。当通过整个寻找类的过程仍然未获取Class对象，则抛出ClassNotFoundException异常。</p>
<p>如果类需要resolve，在调用resolveClass进行链接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">protected synchronized Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException  </span><br><span class="line">&#123;  </span><br><span class="line">// First, check if the class has already been loaded  </span><br><span class="line">Class c = findLoadedClass(name);  </span><br><span class="line">if (c == null) &#123;  </span><br><span class="line">    try &#123;  </span><br><span class="line">    if (parent != null) &#123;  </span><br><span class="line">        c = parent.loadClass(name, false);  </span><br><span class="line">    &#125; else &#123;  </span><br><span class="line">        c = findBootstrapClassOrNull(name);  </span><br><span class="line">    &#125;  </span><br><span class="line">    &#125; catch (ClassNotFoundException e) &#123;  </span><br><span class="line">               // ClassNotFoundException thrown if class not found  </span><br><span class="line">               // from the non-null parent class loader  </span><br><span class="line">           &#125;  </span><br><span class="line">           if (c == null) &#123;  </span><br><span class="line">        // If still not found, then invoke findClass in order  </span><br><span class="line">        // to find the class.  </span><br><span class="line">        c = findClass(name);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">if (resolve) &#123;  </span><br><span class="line">    resolveClass(c);  </span><br><span class="line">&#125;  </span><br><span class="line">return c;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>findLoadedClass 此方法负责从当前ClassLoader实例对象的缓存中寻找已加载的类，调用的为native方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected final Class&lt;?&gt; findLoadedClass(String name) &#123;  </span><br><span class="line">(!checkName(name))  </span><br><span class="line"> return null;  </span><br><span class="line">urn findLoadedClass0(name);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">private native final Class findLoadedClass0(String name);  </span><br></pre></td></tr></table></figure>
<p>findClass 此方法直接抛出ClassNotFoundException异常，因此要通过覆盖loadClass或此方法来以自定义的方式加载相应的类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123;  </span><br><span class="line">ow new ClassNotFoundException(name);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>findSystemClass  此方法是从sun.misc.Launcher$AppClassLoader中寻找类，如果未找到，则继续从BootstrapClassLoader中寻找，如果仍然未找到，返回null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   protected final Class&lt;?&gt; findSystemClass(String name)  </span><br><span class="line">throws ClassNotFoundException  </span><br><span class="line">   &#123;  </span><br><span class="line">ClassLoader system = getSystemClassLoader();  </span><br><span class="line">if (system == null) &#123;  </span><br><span class="line">    if (!checkName(name))  </span><br><span class="line">    throw new ClassNotFoundException(name);  </span><br><span class="line">           Class cls = findBootstrapClass(name);  </span><br><span class="line">           if (cls == null) &#123;  </span><br><span class="line">               throw new ClassNotFoundException(name);  </span><br><span class="line">           &#125;   </span><br><span class="line">    return cls;  </span><br><span class="line">&#125;  </span><br><span class="line">return system.loadClass(name);  </span><br><span class="line">   &#125;  </span><br></pre></td></tr></table></figure>
<p>defineClass 此方法负责将二进制字节流转换为Class对象，这个方法对于自定义类加载器而言非常重要。如果二进制的字节码的格式不符合jvm class文件格式规范，则抛出ClassFormatError异常；如果生成的类名和二进制字节码不同，则抛出NoClassDefFoundError；如果加载的class是受保护的、采用不同签名的，或者类名是以java.开头的，则抛出SecurityException异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">protected final Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len,  </span><br><span class="line">                     ProtectionDomain protectionDomain)  </span><br><span class="line">    throws ClassFormatError  </span><br><span class="line">    &#123;  </span><br><span class="line">         return defineClassCond(name, b, off, len, protectionDomain, true);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    // Private method w/ an extra argument for skipping class verification  </span><br><span class="line">    private final Class&lt;?&gt; defineClassCond(String name,  </span><br><span class="line">                                           byte[] b, int off, int len,  </span><br><span class="line">                                           ProtectionDomain protectionDomain,  </span><br><span class="line">                                           boolean verify)  </span><br><span class="line">        throws ClassFormatError  </span><br><span class="line">    &#123;  </span><br><span class="line">    protectionDomain = preDefineClass(name, protectionDomain);  </span><br><span class="line"></span><br><span class="line">    Class c = null;  </span><br><span class="line">        String source = defineClassSourceLocation(protectionDomain);  </span><br><span class="line"></span><br><span class="line">    try &#123;  </span><br><span class="line">        c = defineClass1(name, b, off, len, protectionDomain, source,  </span><br><span class="line">                             verify);  </span><br><span class="line">    &#125; catch (ClassFormatError cfe) &#123;  </span><br><span class="line">        c = defineTransformedClass(name, b, off, len, protectionDomain, cfe,  </span><br><span class="line">                                       source, verify);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    postDefineClass(c, protectionDomain);  </span><br><span class="line">    return c;  </span><br><span class="line">    &#125;  </span><br></pre></td></tr></table></figure>
<p>resolveClass 此方法负责完成Class对象的链接，如果链接过，则直接返回。</p>
<h2 id="常见异常："><a href="#常见异常：" class="headerlink" title="常见异常："></a>常见异常：</h2><p>ClassNotFoundException  这是最常见的异常，产生这个异常的原因为在当前的ClassLoader 中加载类时，未找到类文件，</p>
<p>NoClassDefFoundError  这个异常是因为  加载到的类中引用到的另外类不存在，例如要加载A，而A中盗用了B，B不存在或当前的ClassLoader无法加载B，就会抛出这个异常。</p>
<p>LinkageError 该异常在自定义ClassLoader的情况下更容易出现，主要原因是此类已经在ClassLoader加载过了，重复的加载会造成该异常。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-8.%E6%9F%A5%E7%9C%8BJVM%E5%8F%82%E6%95%B0%E5%8F%8A%E5%80%BC%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-8.%E6%9F%A5%E7%9C%8BJVM%E5%8F%82%E6%95%B0%E5%8F%8A%E5%80%BC%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">Java虚拟机学习-8.查看JVM参数及值的命令行工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-08 11:40:21" itemprop="dateCreated datePublished" datetime="2017-01-08T11:40:21+08:00">2017-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8042010">http://blog.csdn.net/java2000_wl/article/details/8042010</a></p>
<p>查看JVM各个参数值方式</p>
<h2 id="HotSpot-vm中的各个globals-hpp文件-查看jvm初始的默认值及参数"><a href="#HotSpot-vm中的各个globals-hpp文件-查看jvm初始的默认值及参数" class="headerlink" title="HotSpot vm中的各个globals.hpp文件  查看jvm初始的默认值及参数"></a>HotSpot vm中的各个globals.hpp文件  查看jvm初始的默认值及参数</h2><p><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/runtime/globals.hpp">globals.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/runtime/globals_extension.hpp">globals_extension.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/c1/c1_globals.hpp">c1_globals.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/linux/vm/c1_globals_linux.hpp">c1_globals_linux.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/solaris/vm/c1_globals_solaris.hpp">c1_globals_solaris.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/sparc/vm/c1_globals_sparc.hpp">c1_globals_sparc.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/windows/vm/c1_globals_windows.hpp">c1_globals_windows.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/x86/vm/c1_globals_x86.hpp">c1_globals_x86.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/opto/c2_globals.hpp">c2_globals.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/linux/vm/c2_globals_linux.hpp">c2_globals_linux.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/solaris/vm/c2_globals_solaris.hpp">c2_globals_solaris.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/sparc/vm/c2_globals_sparc.hpp">c2_globals_sparc.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/windows/vm/c2_globals_windows.hpp">c2_globals_windows.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/x86/vm/c2_globals_x86.hpp">c2_globals_x86.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/gc_implementation/g1/g1_globals.hpp">g1_globals.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/linux/vm/globals_linux.hpp">globals_linux.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os_cpu/linux_sparc/vm/globals_linux_sparc.hpp">globals_linux_sparc.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os_cpu/linux_x86/vm/globals_linux_x86.hpp">globals_linux_x86.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os_cpu/linux_zero/vm/globals_linux_zero.hpp">globals_linux_zero.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/solaris/vm/globals_solaris.hpp">globals_solaris.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os_cpu/solaris_sparc/vm/globals_solaris_sparc.hpp">globals_solaris_sparc.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os_cpu/solaris_x86/vm/globals_solaris_x86.hpp">globals_solaris_x86.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/sparc/vm/globals_sparc.hpp">globals_sparc.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os/windows/vm/globals_windows.hpp">globals_windows.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/os_cpu/windows_x86/vm/globals_windows_x86.hpp">globals_windows_x86.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/x86/vm/globals_x86.hpp">globals_x86.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/zero/vm/globals_zero.hpp">globals_zero.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/shark/shark_globals.hpp">shark_globals.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/cpu/zero/vm/shark_globals_zero.hpp">shark_globals_zero.hpp</a><br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/hsx/hsx20/master/file/f0f676c5a2c6/src/share/vm/runtime/arguments.cpp">arguments.cpp</a></p>
<h2 id="XX-PrintFlagsInitial参数"><a href="#XX-PrintFlagsInitial参数" class="headerlink" title="-XX:+PrintFlagsInitial参数"></a>-XX:+PrintFlagsInitial参数</h2><p>显示所有可设置参数及默认值，可结合-XX:+PrintFlagsInitial与-XX:+PrintFlagsFinal对比设置前、设置后的差异，方便知道对那些参数做了调整。</p>
<p><img src="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-8.%E6%9F%A5%E7%9C%8BJVM%E5%8F%82%E6%95%B0%E5%8F%8A%E5%80%BC%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/-XX:+PrintFlagsInitial%E5%8F%82%E6%95%B0.png" alt="-XX:+PrintFlagsInitial参数"></p>
<h2 id="XX-PrintFlagsFinal参数"><a href="#XX-PrintFlagsFinal参数" class="headerlink" title="-XX:+PrintFlagsFinal参数"></a>-XX:+PrintFlagsFinal参数</h2><p>可以获取到所有可设置参数及值(手动设置之后的值)，这个参数只能使用在Jdk6 update 21以上版本(包括该版本)。-XX:+PrintFlagsFinal参数的使用 与上面-XX:+PrintFlagsInitial 参数使用相同  java -XX:+PrintFlagsFinal</p>
<h2 id="使用-jinfo-命令-查看或设置某个参数的值"><a href="#使用-jinfo-命令-查看或设置某个参数的值" class="headerlink" title="使用 jinfo 命令 查看或设置某个参数的值,"></a>使用 jinfo 命令 查看或设置某个参数的值,</h2><p>jinfo命令格式：<br><code>jinfo [option] &lt;pid&gt;</code></p>
<p>pid虚拟机进程id  可以通过  jps命令查看</p>
<p>例子：查询MaxPermSize 参数的值</p>
<p><img src="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-8.%E6%9F%A5%E7%9C%8BJVM%E5%8F%82%E6%95%B0%E5%8F%8A%E5%80%BC%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/jinfo.png" alt="jinfo"></p>
<p>或直接使用 jinfo -flags pid 查看vm的所有设置参数</p>
<h2 id="XX-PrintCommandLineFlags参数"><a href="#XX-PrintCommandLineFlags参数" class="headerlink" title="-XX:+PrintCommandLineFlags参数"></a>-XX:+PrintCommandLineFlags参数</h2><p>显示出JVM初始化完毕后所有跟最初的默认值不同的参数及它们的值。</p>
<p><img src="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-8.%E6%9F%A5%E7%9C%8BJVM%E5%8F%82%E6%95%B0%E5%8F%8A%E5%80%BC%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/-XX:+PrintCommandLineFlags%E5%8F%82%E6%95%B0.png" alt="-XX:+PrintCommandLineFlags参数"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wetts.github.io/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-7.%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zhang Wetts">
      <meta itemprop="description" content="Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p>">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wetts's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-7.%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6/" class="post-title-link" itemprop="url">Java虚拟机学习-7.对象内存分配与回收</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-01-08 11:24:00" itemprop="dateCreated datePublished" datetime="2017-01-08T11:24:00+08:00">2017-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/java2000_wl/article/details/8038855">http://blog.csdn.net/java2000_wl/article/details/8038855</a></p>
<h2 id="对象优先在Eden上分配"><a href="#对象优先在Eden上分配" class="headerlink" title="对象优先在Eden上分配"></a>对象优先在Eden上分配</h2><p>大多数情况下，对象优先在新生代Eden区域中分配。当Eden内存区域没有足够的空间进行分配时，虚拟机将触发一次 Minor GC(新生代GC)。Minor GC期间虚拟机将Eden区域的对象移动到其中一块Survivor区域。</p>
<p><img src="/2017/01/08/%E8%AF%AD%E8%A8%80/Java/%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AD%A6%E4%B9%A0-7.%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6/1.png" alt="1"></p>
<h2 id="大对象直接进入老年代"><a href="#大对象直接进入老年代" class="headerlink" title="大对象直接进入老年代"></a>大对象直接进入老年代</h2><p>所谓大对象是指需要大量连续空间的对象。虚拟机提供了一个XX:PretenureSizeThreshold参数，令大于这个值的对象直接在老年代中分配。</p>
<h2 id="长期存活的对象将进入老年代"><a href="#长期存活的对象将进入老年代" class="headerlink" title="长期存活的对象将进入老年代"></a>长期存活的对象将进入老年代</h2><p>虚拟机采用分代收集的思想管理内存，那内存回收时就必须能识别那些对象该放到新生代，那些该到老年代中。为了做到这点，虚拟机为每个对象定义了一个对象年龄Age，每经过一次新生代GC后任然存活，将对象的年龄Age增加1岁，当年龄到一定程度（默认为15）时，将会被晋升到老年代中，对象晋升老年代的年龄限定值，可通过-XX:MaxTenuringThreshold来设置。</p>
<h2 id="Minor-GC-和Full-GC区别"><a href="#Minor-GC-和Full-GC区别" class="headerlink" title="Minor GC 和Full GC区别"></a>Minor GC 和Full GC区别</h2><p>新生代GC(Minor GC)：指发生在新生代的垃圾收集动作，因为对象大多都具备朝生夕灭特性，所以Minor GC非常频繁，回收速度也比较快。</p>
<p>老年代GC(Major GC / Full GC)：指发生在老年代中的GC，出现Major GC后，经常会伴随至少一次的 Minor GC。Major GC的速度一般会比Minor GC慢10倍以上。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/22/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/70/">70</a><a class="extend next" rel="next" href="/page/24/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhang Wetts"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Zhang Wetts</p>
  <div class="site-description" itemprop="description">Stay Hungry, Stay Foolish. <br><br><p style="font-size:8px;">[build by hexo/next/gitalk/hexo-generator-search/LaTeX]</p></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">691</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">342</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wetts" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wetts" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhang.wetts@163.com" title="E-Mail → mailto:zhang.wetts@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Wetts</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
